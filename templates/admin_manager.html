{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
    <!-- Header with User Info and Logout -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold">{{ user }} ({{ role }})</h1>
                <p class="text-blue-100 mt-1">Admin Manager Dashboard - Complete system oversight and employee management</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                    <p class="text-sm opacity-90">Today</p>
                    <p class="text-lg font-semibold">{{ today }}</p>
                </div>
                <button onclick="window.history.back()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </button>
                <a href="{{ url_for('logout') }}" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="space-y-2">
                {% for message in messages %}
                    <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative flash-message" role="alert">
                        <span class="block sm:inline">{{ message }}</span>
                        <span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="this.parentElement.style.display='none'">Ã—</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Stats Cards -->
    <div class="grid grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-500 rounded-xl p-4 text-white hover-scale shadow-hover">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold">{{ all_employees|length }}</h3>
                    <p class="text-blue-100 text-sm">total employees</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-2">
                    <i class="fas fa-users text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-green-500 rounded-xl p-4 text-white hover-scale shadow-hover">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold">{{ active_employees_count or 0 }}</h3>
                    <p class="text-green-100 text-sm">active employees</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-2">
                    <i class="fas fa-user-check text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-blue-500 rounded-xl p-4 text-white hover-scale shadow-hover">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold">{{ (pending_asset_requests|length or 0) + (approved_asset_requests|length or 0) + (rejected_asset_requests|length or 0) }}</h3>
                    <p class="text-blue-100 text-sm">asset requests</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-2">
                    <i class="fas fa-clipboard-list text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Conditional fourth card based on role -->
        {% if role == 'Lead Staffing Specialist' %}
        <div class="bg-purple-500 rounded-xl p-4 text-white hover-scale shadow-hover">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold">â‚¹{{ "%.0f"|format(total_monthly_payroll or 0) }}</h3>
                    <p class="text-purple-100 text-sm">monthly payroll</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-2">
                    <i class="fas fa-dollar-sign text-2xl"></i>
                </div>
            </div>
        </div>
        {% else %}
        <div class="bg-blue-500 rounded-xl p-4 text-white hover-scale shadow-hover">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold">{{ team_work_history|length or 0 }}</h3>
                    <p class="text-blue-100 text-sm">work records</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-2">
                    <i class="fas fa-briefcase text-2xl"></i>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
        <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6" aria-label="Tabs">
                <button class="tab-button active py-4 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-600" data-tab="employee-management">
                    <i class="fas fa-users-cog mr-2"></i>Employee Management
                </button>
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="personal-submissions">
                    <i class="fas fa-user-clock mr-2"></i>My Submissions
                </button>
                <!-- Only show Payroll Management for Lead Staffing Specialist -->
                {% if role == 'Lead Staffing Specialist' %}
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="payroll-management">
                    <i class="fas fa-money-bill-wave mr-2"></i>Payroll Management
                </button>
                {% endif %}
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="asset-management">
                    <i class="fas fa-laptop mr-2"></i>Asset Management
                </button>
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="approvals">
                    <i class="fas fa-check-circle mr-2"></i>Approvals
                </button>
                {% if has_team %}
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="team-history">
                    <i class="fas fa-history mr-2"></i>Team History
                </button>
                {% endif %}
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="resigned-employees">
                    <i class="fas fa-user-times mr-2"></i>Resigned Employees
                </button>
                <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="work-assignments">
                    <i class="fas fa-tasks mr-2"></i>Work Assignments
                </button>
            </nav>
        </div>

        <div class="p-6">
            <!-- Employee Management Tab -->
            <div id="employee-management" class="tab-content">
                <div class="space-y-6">
                    <!-- Add New Employee Form -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-user-plus text-blue-600 mr-2"></i>Add New Employee - Complete Registration
                            </h2>
                        </div>
                        <div class="p-6">
                            <form method="post" action="{{ url_for('add_employee_action') }}" enctype="multipart/form-data" class="space-y-6">
                                <!-- Basic Information -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-user text-blue-600 mr-2"></i>Basic Information
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Username *</label>
                                            <input type="text" name="username" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter unique username">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                            <input type="text" name="name" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter full name">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                            <input type="email" name="email" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter email address">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                                            <input type="password" name="password" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter password">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Role *</label>
                                            <select name="role" required class="form-select w-full rounded-lg border-gray-300">
                                                <option value="">Select Role</option>
                                                <option value="Admin Manager">Admin Manager</option>
                                                <option value="Manager">Manager</option>
                                                <option value="Rm">RM</option>
                                                <option value="Employee">Employee</option>
                                                <option value="Intern">Intern</option>
                                                <option value="Lead">Lead</option>
                                                <option value="Product Owner">Product Owner</option>
                                                <option value="BDE Manager">BDE Manager</option>
                                                <option value="Lead Staffing Specialist">Lead Staffing Specialist</option>
                                                <option value="SAP Consultant">SAP Consultant</option>
                                                <option value="Contractor">Contractor</option>
                                                <option value="Hr & Finance Controller">HR & Finance Controller</option>
                                                <option value="Finance Manager">Finance Manager</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Reporting Manager</label>
                                            <select name="reporting_manager" class="form-select w-full rounded-lg border-gray-300">
                                                <option value="">Select Manager</option>
                                                {% for manager in all_managers %}
                                                <option value="{{ manager.username }}">{{ manager.name }} ({{ manager.username }})</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Employment Details -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-briefcase text-green-600 mr-2"></i>Employment Details
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Joining Date *</label>
                                            <input type="date" name="joining_date" required class="form-input w-full rounded-lg border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Employment Type</label>
                                            <input type="text" 
                                                   name="employment_type" 
                                                   class="form-input w-full rounded-lg border-gray-300" 
                                                   placeholder="Enter employment type"
                                                   list="employment-types"
                                                   oninput="toggleDurationFieldForInput(this)">
                                            <datalist id="employment-types">
                                                <option value="Fulltime">
                                                <option value="Contractual">
                                                <option value="Freelancer">
                                                <option value="Intern">
                                                <option value="Remote">
                                                <option value="Hybrid">
                                                <option value="Part-time">
                                                <option value="Consultant">
                                            </datalist>
                                        </div>
                                        <div id="duration-field" class="hidden">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Duration (months)</label>
                                            <input type="number" name="duration" class="form-input w-full rounded-lg border-gray-300" placeholder="Contract duration">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Blood Group</label>
                                            <select name="blood_group" class="form-select w-full rounded-lg border-gray-300">
                                                <option value="">Select Blood Group</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Information -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-phone text-purple-600 mr-2"></i>Contact Information
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number *</label>
                                            <input type="tel" name="mobile_number" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter mobile number">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                                            <input type="tel" name="emergency_contact" class="form-input w-full rounded-lg border-gray-300" placeholder="Emergency contact number">
                                        </div>
                                    </div>
                                </div>

                                <!-- Asset Issuance -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-laptop text-indigo-600 mr-2"></i>Asset Issuance
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="laptop_provided" name="laptop_provided" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                            <label for="laptop_provided" class="ml-2 text-sm text-gray-700">Laptop Provided</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="id_card_provided" name="id_card_provided" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                            <label for="id_card_provided" class="ml-2 text-sm text-gray-700">ID Card Provided</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="email_provided" name="email_provided" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                            <label for="email_provided" class="ml-2 text-sm text-gray-700">Email Access Provided</label>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ID Card Details</label>
                                            <input type="text" name="id_card" class="form-input w-full rounded-lg border-gray-300" placeholder="ID Card number or details">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Asset Details</label>
                                            <textarea name="asset_details" rows="3" class="form-textarea w-full rounded-lg border-gray-300" placeholder="Additional asset details (laptop model, serial numbers, etc.)"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Documents & Identification -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-id-card text-red-600 mr-2"></i>Documents & Identification
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Aadhaar Number</label>
                                            <input type="text" name="adhaar_number" class="form-input w-full rounded-lg border-gray-300" placeholder="Enter Aadhaar number" maxlength="12">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">PAN Number</label>
                                            <input type="text" name="pan_number" class="form-input w-full rounded-lg border-gray-300" placeholder="Enter PAN number" maxlength="10">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn URL</label>
                                            <input type="url" name="linkedin_url" class="form-input w-full rounded-lg border-gray-300" placeholder="https://linkedin.com/in/username">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Upload Photo</label>
                                            <input type="file" name="photo" accept="image/*" class="form-input w-full rounded-lg border-gray-300">
                                            <p class="text-xs text-gray-500 mt-1">Upload employee photo (JPG, PNG, max 5MB)</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Photo URL (Alternative)</label>
                                            <input type="url" name="photo_url" class="form-input w-full rounded-lg border-gray-300" placeholder="https://example.com/photo.jpg">
                                            <p class="text-xs text-gray-500 mt-1">Or provide photo URL</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Leave Balance -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h3 class="text-md font-semibold text-gray-800 mb-4">
                                        <i class="fas fa-calendar-alt text-orange-600 mr-2"></i>Leave Balance Configuration
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Total Leaves</label>
                                            <input type="number" name="total_leaves" value="36" class="form-input w-full rounded-lg border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Sick Leaves</label>
                                            <input type="number" name="sick_total" value="12" class="form-input w-full rounded-lg border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Paid Leaves</label>
                                            <input type="number" name="paid_total" value="18" class="form-input w-full rounded-lg border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Casual Leaves</label>
                                            <input type="number" name="casual_total" value="6" class="form-input w-full rounded-lg border-gray-300">
                                        </div>
                                    </div>
                                </div>

                                <div class="flex justify-end space-x-4">
                                    <button type="reset" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-undo mr-2"></i>Reset Form
                                    </button>
                                    <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                        <i class="fas fa-user-plus mr-2"></i>Add Employee
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- All Employees List -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-users text-green-600 mr-2"></i>All Employees ({{ all_employees|length }})
                            </h2>
                        </div>
                        <div class="p-6">
                            {% if all_employees %}
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 table-hover">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employment</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assets</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            {% for employee in all_employees %}
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-shrink-0 h-10 w-10">
                                                            {% if employee.photo_url %}
                                                                <img class="h-10 w-10 rounded-full object-cover" src="{{ employee.photo_url }}" alt="{{ employee.name }}">
                                                            {% else %}
                                                                <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                                    <span class="text-sm font-medium text-blue-600">{{ employee.name[0]|upper if employee.name else employee.username[0]|upper }}</span>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="ml-4">
                                                            <div class="text-sm font-medium text-gray-900">{{ employee.name or employee.username }}</div>
                                                            <div class="text-sm text-gray-500">{{ employee.username }}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                        {% if employee.role == 'Manager' %}bg-blue-100 text-blue-800
                                                        {% elif employee.role == 'Admin Manager' %}bg-red-100 text-red-800
                                                        {% elif employee.role == 'Rm' %}bg-green-100 text-green-800
                                                        {% elif employee.role == 'Employee' %}bg-gray-100 text-gray-800
                                                        {% elif employee.role == 'Intern' %}bg-yellow-100 text-yellow-800
                                                        {% else %}bg-purple-100 text-purple-800{% endif %}">
                                                        {{ employee.role }}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <div>{{ employee.employment_type or 'N/A' }}</div>
                                                    <div class="text-xs text-gray-500">{{ employee.joining_date or 'N/A' }}</div>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <div>{{ employee.mobile_number or 'N/A' }}</div>
                                                    <div class="text-xs text-gray-500">{{ employee.email or 'N/A' }}</div>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <div class="flex space-x-1">
                                                        {% if employee.laptop_provided %}
                                                            <span class="inline-flex px-1 py-1 text-xs bg-blue-100 text-blue-800 rounded">ðŸ’»</span>
                                                        {% endif %}
                                                        {% if employee.id_card_provided %}
                                                            <span class="inline-flex px-1 py-1 text-xs bg-green-100 text-green-800 rounded">ðŸ†”</span>
                                                        {% endif %}
                                                        {% if employee.email_provided %}
                                                            <span class="inline-flex px-1 py-1 text-xs bg-purple-100 text-purple-800 rounded">ðŸ“§</span>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium space-x-1">
                                                    <button class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 border border-blue-200 rounded hover:bg-blue-50 transition-colors" 
                                                            onclick="editEmployee('{{ employee.username }}', '{{ employee.name or '' }}', '{{ employee.email or '' }}', '{{ employee.role or '' }}', '{{ employee.mobile_number or '' }}')">
                                                        <i class="fas fa-edit mr-1"></i>Edit
                                                    </button>
                                                    <button class="text-green-600 hover:text-green-800 text-xs px-2 py-1 border border-green-200 rounded hover:bg-green-50 transition-colors" onclick="viewEmployeeDetails('{{ employee.username }}')">
                                                        <i class="fas fa-eye mr-1"></i>View
                                                    </button>
                                                    <button class="text-red-600 hover:text-red-800 text-xs px-2 py-1 border border-red-200 rounded hover:bg-red-50 transition-colors" onclick="deleteEmployee('{{ employee.username }}')">
                                                        <i class="fas fa-user-times mr-1"></i>Delete
                                                    </button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center py-8">
                                    <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-500">No employees found</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Submissions Tab -->
            <div id="personal-submissions" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Personal Timesheet Submission -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>Submit Personal Timesheet
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">Log your work hours for RM approval</p>
                        </div>
                        <div class="p-6">
                            <form method="post" action="{{ url_for('submit_timesheet_action') }}" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Project *</label>
                                        <select name="project" required class="form-select w-full rounded-lg border-gray-300">
                                            {% for project in proj_list %}
                                            <option value="{{ project }}">{{ project }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Work Date *</label>
                                        <input type="date" name="work_date" required class="form-input w-full rounded-lg border-gray-300" max="{{ today }}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Break Hours</label>
                                        <input type="number" step="0.5" name="brk" value="1.0" min="0" max="8" class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time *</label>
                                        <input type="time" name="start_t" required class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">End Time *</label>
                                        <input type="time" name="end_t" required class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Description *</label>
                                    <textarea name="desc" rows="3" required class="form-textarea w-full rounded-lg border-gray-300" placeholder="Describe your work activities..."></textarea>
                                </div>

                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-paper-plane mr-2"></i>Submit Timesheet for Approval
                                </button>
                            </form>
                        </div>
                    </div>
 
                    <!-- Personal Leave Request -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-calendar-alt text-green-600 mr-2"></i>Request Personal Leave
                            </h2>
                            <div class="mt-2 text-sm text-gray-600">
                                <div class="flex space-x-4">
                                    <span>Sick: {{ personal_remaining_leaves.sick or 0 }} days</span>
                                    <span>Paid: {{ personal_remaining_leaves.paid or 0 }} days</span>
                                    <span>Casual: {{ personal_remaining_leaves.casual or 0 }} days</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <form method="post" action="{{ url_for('request_leave_action') }}" enctype="multipart/form-data" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type *</label>
                                        <select name="leave_type" required class="form-select w-full rounded-lg border-gray-300">
                                            <option value="">Select Type</option>
                                            <option value="Sick">Sick Leave</option>
                                            <option value="Vacation">Vacation</option>
                                            <option value="Personal">Personal Leave</option>
                                            <option value="Casual">Casual Leave</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date *</label>
                                        <input type="date" name="start_d" required class="form-input w-full rounded-lg border-gray-300" min="{{ today }}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">End Date *</label>
                                        <input type="date" name="end_d" required class="form-input w-full rounded-lg border-gray-300" min="{{ today }}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Medical Certificate</label>
                                        <input type="file" name="doc" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" class="form-input w-full rounded-lg border-gray-300">
                                        <p class="text-xs text-gray-500 mt-1">Required for sick leave > 2 days</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Leave Description *</label>
                                    <textarea name="description" rows="3" required class="form-textarea w-full rounded-lg border-gray-300" placeholder="Reason for leave..."></textarea>
                                </div>
                                
                                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-calendar-plus mr-2"></i>Submit Leave Request for Approval
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Personal Work & Leave History with Document Viewing -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-history text-purple-600 mr-2"></i>My Work & Leave History
                            </h2>
                        </div>
                        <div class="p-6">
                            <!-- Personal Work History Table -->
                            {% if personal_work_history %}
                            <div class="mb-8">
                                <h3 class="text-md font-semibold text-gray-700 mb-4">Work History</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hours</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            {% for work in personal_work_history %}
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">{{ work.work_date }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">{{ work.project_name or '(non-project)' }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">{{ work.hours }}h</td>
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                        {% if work.rm_status == 'Approved' %}bg-green-100 text-green-800
                                                        {% elif work.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                        {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                                        {{ work.rm_status }}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-4 text-sm max-w-xs truncate">{{ work.work_desc }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Personal Leave History with Document Viewing -->
                            {% if personal_leaves %}
                            <div>
                                <h3 class="text-md font-semibold text-gray-700 mb-4">Leave History</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start Date</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">End Date</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Document</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            {% for leave in personal_leaves %}
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                        {% if leave.leave_type == 'Sick' %}bg-red-100 text-red-800
                                                        {% elif leave.leave_type in ['Vacation', 'Personal'] %}bg-green-100 text-green-800
                                                        {% else %}bg-blue-100 text-blue-800{% endif %}">
                                                        {{ leave.leave_type }}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">{{ leave.start_date }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">{{ leave.end_date }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                        {% if leave.rm_status == 'Approved' %}bg-green-100 text-green-800
                                                        {% elif leave.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                        {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                                        {{ leave.rm_status }}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">
                                                    {% if leave.health_document %}
                                                        <div class="flex space-x-2">
                                                            <a href="{{ url_for('view_leave_document', leave_id=leave.id) }}" 
                                                               target="_blank" 
                                                               class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-50 rounded-md border border-blue-200 hover:bg-blue-100 transition-colors">
                                                                <i class="fas fa-eye mr-1"></i>View
                                                            </a>
                                                            <a href="{{ url_for('download_leave_document', leave_id=leave.id) }}" 
                                                               class="text-green-600 hover:text-green-800 text-xs px-2 py-1 bg-green-50 rounded-md border border-green-200 hover:bg-green-100 transition-colors">
                                                                <i class="fas fa-download mr-1"></i>Download
                                                            </a>
                                                        </div>
                                                    {% else %}
                                                        <span class="text-gray-400 text-xs">No document</span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-4 py-4 text-sm max-w-xs truncate">{{ leave.description }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}

                            {% if not personal_work_history and not personal_leaves %}
                            <div class="text-center py-12">
                                <i class="fas fa-history text-4xl text-gray-300 mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-800 mb-2">No Personal Records</h3>
                                <p class="text-gray-500">You haven't submitted any timesheets or leave requests yet.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payroll Management Tab - UPDATED FOR LEAD STAFFING SPECIALIST -->
            {% if role == 'Lead Staffing Specialist' %}
            <div id="payroll-management" class="tab-content hidden">
                <!-- Payroll Summary -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-chart-line text-purple-600 mr-2"></i>Payroll Summary - View Only
                        </h2>
                        <p class="text-sm text-gray-600 mt-1">View-only access to payroll information</p>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <h4 class="text-lg font-semibold text-green-800">Total Monthly</h4>
                                <p class="text-2xl font-bold text-green-600">â‚¹{{ "%.0f"|format(total_monthly_payroll or 0) }}</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <h4 class="text-lg font-semibold text-blue-800">Total Yearly</h4>
                                <p class="text-2xl font-bold text-blue-600">â‚¹{{ "%.0f"|format(total_yearly_payroll or 0) }}</p>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <h4 class="text-lg font-semibold text-purple-800">Paid Employees</h4>
                                <p class="text-2xl font-bold text-purple-600">{{ paid_employees_count or 0 }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Employee Salary Information - READ ONLY -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 mt-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-eye text-green-600 mr-2"></i>Employee Salary Information - View Only
                        </h2>
                        <p class="text-sm text-gray-600 mt-1">Read-only view of employee salary information</p>
                    </div>
                    <div class="p-6">
                        {% if all_employees %}
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monthly Salary (â‚¹)</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yearly Salary (â‚¹)</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employment Type</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for employee in all_employees %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8">
                                                        {% if employee.photo_url %}
                                                            <img class="h-8 w-8 rounded-full object-cover" src="{{ employee.photo_url }}" alt="{{ employee.name }}">
                                                        {% else %}
                                                            <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                                <span class="text-xs font-medium text-blue-600">{{ employee.name[0]|upper if employee.name else employee.username[0]|upper }}</span>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="ml-3">
                                                        <div class="text-sm font-medium text-gray-900">{{ employee.name or employee.username }}</div>
                                                        <div class="text-sm text-gray-500">{{ employee.username }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                    {% if employee.role == 'Manager' %}bg-blue-100 text-blue-800
                                                    {% elif employee.role == 'Admin Manager' %}bg-red-100 text-red-800
                                                    {% elif employee.role == 'Rm' %}bg-green-100 text-green-800
                                                    {% elif employee.role == 'Employee' %}bg-gray-100 text-gray-800
                                                    {% elif employee.role == 'Intern' %}bg-yellow-100 text-yellow-800
                                                    {% else %}bg-purple-100 text-purple-800{% endif %}">
                                                    {{ employee.role }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                                                <span class="{% if employee.monthly_salary and employee.monthly_salary > 0 %}text-green-600{% else %}text-gray-400{% endif %}">
                                                    â‚¹{{ "%.2f"|format(employee.monthly_salary or 0) }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                                                <span class="{% if employee.yearly_salary and employee.yearly_salary > 0 %}text-green-600{% else %}text-gray-400{% endif %}">
                                                    â‚¹{{ "%.2f"|format(employee.yearly_salary or 0) }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {{ employee.employment_type or 'N/A' }}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Summary Footer -->
                            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                    <div>
                                        <p class="text-sm text-gray-600">Total Employees</p>
                                        <p class="text-lg font-semibold text-gray-800">{{ all_employees|length }}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Monthly Payroll</p>
                                        <p class="text-lg font-semibold text-green-600">â‚¹{{ "%.2f"|format(total_monthly_payroll or 0) }}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Yearly Payroll</p>
                                        <p class="text-lg font-semibold text-blue-600">â‚¹{{ "%.2f"|format(total_yearly_payroll or 0) }}</p>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-8">
                                <i class="fas fa-money-bill-wave text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">No employee salary information found</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Asset Management Tab - UPDATED WITH DOCUMENT UPLOAD -->
            <div id="asset-management" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Asset Summary Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>Asset Request Summary - All Status
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="text-center p-4 bg-orange-50 rounded-lg">
                                    <h4 class="text-lg font-semibold text-orange-800">Pending</h4>
                                    <p class="text-2xl font-bold text-orange-600">{{ pending_asset_requests|length or 0 }}</p>
                                    <p class="text-sm text-gray-600">â‚¹{{ "%.2f"|format(total_pending_asset_cost or 0) }}</p>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <h4 class="text-lg font-semibold text-green-800">Approved</h4>
                                    <p class="text-2xl font-bold text-green-600">{{ approved_asset_requests|length or 0 }}</p>
                                    <p class="text-sm text-gray-600">â‚¹{{ "%.2f"|format(total_approved_asset_cost or 0) }}</p>
                                </div>
                                <div class="text-center p-4 bg-red-50 rounded-lg">
                                    <h4 class="text-lg font-semibold text-red-800">Rejected</h4>
                                    <p class="text-2xl font-bold text-red-600">{{ rejected_asset_requests|length or 0 }}</p>
                                    <p class="text-sm text-gray-600">â‚¹{{ "%.2f"|format(total_rejected_asset_cost or 0) }}</p>
                                </div>
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <h4 class="text-lg font-semibold text-blue-800">Total Requests</h4>
                                    <p class="text-2xl font-bold text-blue-600">{{ all_asset_requests|length or 0 }}</p>
                                    <p class="text-sm text-gray-600">â‚¹{{ "%.2f"|format((total_pending_asset_cost or 0) + (total_approved_asset_cost or 0) + (total_rejected_asset_cost or 0)) }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Asset Request Form with Document Upload -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-plus text-blue-600 mr-2"></i>Request Assets with Document Upload
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">Submit asset requests with supporting documents (Sent to Divya & Sabitha)</p>
                        </div>
                        <div class="p-6">
                            <form method="post" action="{{ url_for('request_asset_with_document') }}" enctype="multipart/form-data" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Asset Type *</label>
                                        <select name="asset_type" required class="form-select w-full rounded-lg border-gray-300">
                                            <option value="">Select Asset</option>
                                            <option value="Laptop">Laptop</option>
                                            <option value="ID Card">ID Card</option>
                                            <option value="Tea Cup">Tea Cup</option>
                                            <option value="Mobile Phone">Mobile Phone</option>
                                            <option value="Monitor">Monitor</option>
                                            <option value="Keyboard">Keyboard</option>
                                            <option value="Mouse">Mouse</option>
                                            <option value="Chair">Chair</option>
                                            <option value="Desk">Desk</option>
                                            <option value="Headphones">Headphones</option>
                                            <option value="Webcam">Webcam</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantity *</label>
                                        <input type="number" name="quantity" value="1" min="1" required class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount (â‚¹) *</label>
                                        <input type="number" step="0.01" name="amount" min="0" required class="form-input w-full rounded-lg border-gray-300" placeholder="Enter cost">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Employee (Optional)</label>
                                        <select name="for_employee" class="form-select w-full rounded-lg border-gray-300">
                                            <option value="">Select Employee</option>
                                            {% for emp in all_employees %}
                                            <option value="{{ emp.username }}">{{ emp.name or emp.username }} ({{ emp.role }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Request Description *</label>
                                        <textarea name="description" rows="3" required class="form-textarea w-full rounded-lg border-gray-300" placeholder="Describe the asset request and reason..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload Supporting Document</label>
                                        <input type="file" name="asset_document" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" class="form-input w-full rounded-lg border-gray-300">
                                        <p class="text-xs text-gray-500 mt-1">Upload quotation, specifications, or other supporting documents (PDF, JPG, PNG, DOC, DOCX - max 10MB)</p>
                                    </div>
                                </div>
                                
                                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-paper-plane mr-2"></i>Send Asset Request with Document to Divya & Sabitha
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- ALL Asset Requests Table with Document Access -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-list text-purple-600 mr-2"></i>All Asset Requests ({{ all_asset_requests|length or 0 }})
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">Complete history of asset requests with current status and document access</p>
                        </div>
                        <div class="p-6">
                            {% if all_asset_requests %}
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset Type</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount (â‚¹)</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">For Employee</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Requested By</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Date</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action By</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            {% for request in all_asset_requests %}
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                    <i class="fas fa-laptop mr-2 text-gray-600"></i>{{ request.asset_type }}
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ request.quantity }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                                                    <span class="{% if request.status == 'Approved' %}text-green-600{% elif request.status == 'Rejected' %}text-red-600{% else %}text-orange-600{% endif %}">
                                                        â‚¹{{ "%.2f"|format(request.amount or 0) }}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ request.for_employee or 'General Use' }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ request.requested_by }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ request.requested_date }}</td>
                                                <td class="px-4 py-4 whitespace-nowrap">
                                                    {% if request.status == 'Pending' %}
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">
                                                            <i class="fas fa-clock mr-1"></i>Pending
                                                        </span>
                                                    {% elif request.status == 'Approved' %}
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                            <i class="fas fa-check mr-1"></i>Approved
                                                        </span>
                                                    {% elif request.status == 'Rejected' %}
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">
                                                            <i class="fas fa-times mr-1"></i>Rejected
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm">
                                                    {% if request.document_path %}
                                                        <div class="flex space-x-1">
                                                            <a href="{{ url_for('view_asset_document', asset_id=request.id) }}" 
                                                               target="_blank" 
                                                               class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-50 rounded border border-blue-200 hover:bg-blue-100 transition-colors">
                                                                <i class="fas fa-eye mr-1"></i>View
                                                            </a>
                                                            <a href="{{ url_for('download_asset_document', asset_id=request.id) }}" 
                                                               class="text-green-600 hover:text-green-800 text-xs px-2 py-1 bg-green-50 rounded border border-green-200 hover:bg-green-100 transition-colors">
                                                                <i class="fas fa-download mr-1"></i>Download
                                                            </a>
                                                        </div>
                                                    {% else %}
                                                        <span class="text-gray-400 text-xs">No document</span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    {{ request.approved_by or 'N/A' }}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="9" class="px-4 py-2 bg-gray-50">
                                                    <div class="text-sm text-gray-600">
                                                        <strong>Description:</strong> {{ request.description }}
                                                        {% if request.rejection_reason %}
                                                            <br><strong class="text-red-600">Rejection Reason:</strong> <span class="text-red-600">{{ request.rejection_reason }}</span>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center py-8">
                                    <i class="fas fa-clipboard-list text-4xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-500">No asset requests found</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Assignments Tab -->
            <div id="work-assignments" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Assign Work to Direct Reports -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-user-plus text-blue-600 mr-2"></i>Assign Work to My Direct Reports
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">Assign tasks only to employees directly reporting to you</p>
                        </div>
                        <div class="p-6">
                            {% if direct_reports %}
                            <form method="post" action="{{ url_for('rm_assign_work_action') }}" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Team Members *</label>
                                        <select name="employee_username" multiple required class="form-select w-full rounded-lg border-gray-300" size="6">
                                            {% for employee in direct_reports %}
                                            <option value="{{ employee.username }}">{{ employee.name or employee.username }} ({{ employee.role }})</option>
                                            {% endfor %}
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple employees</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Project (Optional)</label>
                                        <select name="project_name" class="form-select w-full rounded-lg border-gray-300">
                                            <option value="">(No specific project)</option>
                                            {% for project in proj_list %}
                                            <option value="{{ project }}">{{ project }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                                        <input type="date" name="start_date" class="form-input w-full rounded-lg border-gray-300" value="{{ today }}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                                        <input type="date" name="due_date" required class="form-input w-full rounded-lg border-gray-300" min="{{ today }}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                                        <select name="priority" class="form-select w-full rounded-lg border-gray-300">
                                            <option value="Low">Low</option>
                                            <option value="Medium" selected>Medium</option>
                                            <option value="High">High</option>
                                            <option value="Urgent">Urgent</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Task Description *</label>
                                    <textarea name="task_desc" rows="4" required class="form-textarea w-full rounded-lg border-gray-300" placeholder="Describe the task, requirements, and expectations..."></textarea>
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-paper-plane mr-2"></i>Assign Work to Selected Team Members
                                </button>
                            </form>
                            {% else %}
                            <div class="text-center py-8">
                                <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">No direct reports found for work assignment</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Work Assigned BY Admin Manager -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-clipboard-list text-green-600 mr-2"></i>Work Assigned by Me ({{ my_assigned_work|length }})
                            </h2>
                        </div>
                        <div class="p-6">
                            {% if my_assigned_work %}
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assigned To</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Task</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Due Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Urgency</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for assignment in my_assigned_work %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                                                {{ assignment.assigned_to_name or assignment.assigned_to }}
                                            </td>
                                            <td class="px-4 py-4 text-sm max-w-xs">
                                                <div class="truncate" title="{{ assignment.task_desc }}">{{ assignment.task_desc }}</div>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ assignment.project_name or '(No project)' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ assignment.due_date or 'N/A' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                    {% if assignment.rm_status == 'Completed' %}bg-green-100 text-green-800
                                                    {% elif assignment.rm_status == 'In Progress' %}bg-yellow-100 text-yellow-800
                                                    {% elif assignment.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                                                    {{ assignment.rm_status }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                {% if assignment.urgency_status == 'Overdue' %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">
                                                        <i class="fas fa-exclamation-triangle mr-1"></i>Overdue
                                                    </span>
                                                {% elif assignment.urgency_status == 'Due Soon' %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded-full">
                                                        <i class="fas fa-clock mr-1"></i>Due Soon
                                                    </span>
                                                {% else %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                        <i class="fas fa-check mr-1"></i>Active
                                                    </span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-8">
                                <i class="fas fa-clipboard text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">No work assignments created yet</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Work Assigned TO Admin Manager -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-inbox text-purple-600 mr-2"></i>Work Assigned to Me ({{ work_assigned_to_admin|length }})
                            </h2>
                        </div>
                        <div class="p-6">
                            {% if work_assigned_to_admin %}
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assigned By</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Task</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Due Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Urgency</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for assignment in work_assigned_to_admin %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                                                {{ assignment.assigned_by_name or assignment.assigned_by }}
                                            </td>
                                            <td class="px-4 py-4 text-sm max-w-xs">
                                                <div class="truncate" title="{{ assignment.task_desc }}">{{ assignment.task_desc }}</div>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ assignment.project_name or '(No project)' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ assignment.due_date or 'N/A' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                    {% if assignment.rm_status == 'Completed' %}bg-green-100 text-green-800
                                                    {% elif assignment.rm_status == 'In Progress' %}bg-yellow-100 text-yellow-800
                                                    {% elif assignment.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                                                    {{ assignment.rm_status }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                {% if assignment.urgency_status == 'Overdue' %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">
                                                        <i class="fas fa-exclamation-triangle mr-1"></i>Overdue
                                                    </span>
                                                {% elif assignment.urgency_status == 'Due Soon' %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded-full">
                                                        <i class="fas fa-clock mr-1"></i>Due Soon
                                                    </span>
                                                {% else %}
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                        <i class="fas fa-check mr-1"></i>Active
                                                    </span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-8">
                                <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">No work has been assigned to you</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Approvals Tab -->
            <div id="approvals" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Pending Work Approvals Section -->
                    {% if has_team and pending_work_approvals %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-clock text-orange-600 mr-2"></i>Pending Work Approvals ({{ pending_work_approvals|length }})
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hours</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for work in pending_work_approvals %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">{{ work.employee_name or work.username }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ work.work_date }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ work.project_name }}</td>
                                            <td class="px-4 py-4 text-sm max-w-xs truncate">{{ work.work_desc }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold">{{ work.hours }}h</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <form method="POST" action="{{ url_for('approve_timesheet_action') }}" style="display: inline;">
                                                    <input type="hidden" name="id" value="{{ work.id }}">
                                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs transition-colors">
                                                        <i class="fas fa-check mr-1"></i>Approve
                                                    </button>
                                                </form>
                                                <button type="button" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs transition-colors" onclick="rejectWork({{ work.id }})">
                                                    <i class="fas fa-times mr-1"></i>Reject
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Pending Leave Approvals Section with Document Viewing -->
                    {% if has_team and pending_leave_approvals %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-calendar-times text-red-600 mr-2"></i>Pending Leave Approvals ({{ pending_leave_approvals|length }})
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Leave Type</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">End Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Days</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Document</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for leave in pending_leave_approvals %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">{{ leave.employee_name or leave.username }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                    {% if leave.leave_type == 'Sick' %}bg-red-100 text-red-800
                                                    {% elif leave.leave_type == 'Vacation' %}bg-green-100 text-green-800
                                                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                                                    {{ leave.leave_type }}
                                                </span>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ leave.start_date }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">{{ leave.end_date }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold">{{ leave.duration_days }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm">
                                                {% if leave.health_document %}
                                                    <div class="flex space-x-1">
                                                        <a href="{{ url_for('view_leave_document', leave_id=leave.id) }}" 
                                                           target="_blank" 
                                                           class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-50 rounded border border-blue-200 hover:bg-blue-100 transition-colors">
                                                            <i class="fas fa-eye mr-1"></i>View
                                                        </a>
                                                        <a href="{{ url_for('download_leave_document', leave_id=leave.id) }}" 
                                                           class="text-green-600 hover:text-green-800 text-xs px-2 py-1 bg-green-50 rounded border border-green-200 hover:bg-green-100 transition-colors">
                                                            <i class="fas fa-download mr-1"></i>Download
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <span class="text-gray-400 text-xs">No document</span>
                                                {% endif %}
                                            </td>
                                            <td class="px-4 py-4 text-sm max-w-xs truncate">{{ leave.description }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <form method="POST" action="{{ url_for('approve_leave_action') }}" style="display: inline;">
                                                    <input type="hidden" name="id" value="{{ leave.id }}">
                                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs transition-colors">
                                                        <i class="fas fa-check mr-1"></i>Approve
                                                    </button>
                                                </form>
                                                <button type="button" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs transition-colors" onclick="rejectLeave({{ leave.id }})">
                                                    <i class="fas fa-times mr-1"></i>Reject
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if not has_team or (not pending_work_approvals and not pending_leave_approvals) %}
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-12 text-center">
                            <i class="fas fa-check-circle text-4xl text-green-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-800 mb-2">No Pending Approvals</h3>
                            <p class="text-gray-500">All submissions have been processed or there are no team members requiring approval.</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Team History Tab with Document Viewing -->
            {% if has_team %}
            <div id="team-history" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Team Info Header -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-users text-blue-600 mr-2"></i>Team History & Records
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">Complete work and leave history for your team members ({{ direct_reports|length }} direct reports)</p>
                        </div>
                        <div class="p-6">
                            <div class="flex space-x-4">
                                <span class="inline-flex px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full">Team Size: {{ direct_reports|length }}</span>
                                <span class="inline-flex px-3 py-1 text-sm bg-green-100 text-green-800 rounded-full">Work Records: {{ team_work_history|length }}</span>
                                <span class="inline-flex px-3 py-1 text-sm bg-purple-100 text-purple-800 rounded-full">Leave Records: {{ team_leave_history|length }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-tabs for Work and Leave History -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="border-b border-gray-200">
                            <nav class="flex space-x-8 px-6" aria-label="Team History Tabs">
                                <button class="team-tab-button active py-4 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-600" data-tab="team-work-history">
                                    <i class="fas fa-briefcase mr-2"></i>Work History
                                </button>
                                <button class="team-tab-button py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="team-leave-history">
                                    <i class="fas fa-calendar-alt mr-2"></i>Leave History
                                </button>
                            </nav>
                        </div>

                        <div class="p-6">
                            <!-- Team Work History -->
                            <div id="team-work-history" class="team-tab-content">
                                {% if team_work_history %}
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Work Date</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Overtime</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200">
                                                {% for work in team_work_history %}
                                                <tr class="hover:bg-gray-50 transition-colors">
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ work.employee_name or work.username }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ work.work_date }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ work.project_name or '(non-project)' }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ work.hours }}h</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                        {% if work.overtime_hours > 0 %}
                                                            <span class="text-orange-600 font-semibold">{{ work.overtime_hours }}h</span>
                                                        {% else %}
                                                            <span class="text-gray-400">0h</span>
                                                        {% endif %}
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                            {% if work.rm_status == 'Approved' %}bg-green-100 text-green-800
                                                            {% elif work.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                                            {{ work.rm_status }}
                                                        </span>
                                                    </td>
                                                    <td class="px-4 py-4 text-sm text-gray-900 max-w-xs">
                                                        <div class="truncate" title="{{ work.work_desc }}">{{ work.work_desc }}</div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% else %}
                                    <div class="text-center py-12">
                                        <i class="fas fa-briefcase text-4xl text-gray-300 mb-4"></i>
                                        <h3 class="text-lg font-medium text-gray-800 mb-2">No Work History</h3>
                                        <p class="text-gray-500">No work records found for your team members.</p>
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Team Leave History with Document Viewing -->
                            <div id="team-leave-history" class="team-tab-content hidden">
                                {% if team_leave_history %}
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Leave Type</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Days</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200">
                                                {% for leave in team_leave_history %}
                                                <tr class="hover:bg-gray-50 transition-colors">
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ leave.employee_name or leave.username }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                            {% if leave.leave_type == 'Sick' %}bg-red-100 text-red-800
                                                            {% elif leave.leave_type == 'Vacation' or leave.leave_type == 'Personal' %}bg-green-100 text-green-800
                                                            {% else %}bg-blue-100 text-blue-800{% endif %}">
                                                            {{ leave.leave_type }}
                                                        </span>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ leave.start_date }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{{ leave.end_date }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">{{ leave.duration_days or 'N/A' }}</td>
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                                            {% if leave.rm_status == 'Approved' %}bg-green-100 text-green-800
                                                            {% elif leave.rm_status == 'Rejected' %}bg-red-100 text-red-800
                                                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                                            {{ leave.rm_status }}
                                                        </span>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm">
                                                        {% if leave.health_document %}
                                                            <div class="flex space-x-1">
                                                                <a href="{{ url_for('view_leave_document', leave_id=leave.id) }}" 
                                                                   target="_blank" 
                                                                   class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-50 rounded border border-blue-200 hover:bg-blue-100 transition-colors">
                                                                    <i class="fas fa-eye mr-1"></i>View
                                                                </a>
                                                                <a href="{{ url_for('download_leave_document', leave_id=leave.id) }}" 
                                                                   class="text-green-600 hover:text-green-800 text-xs px-2 py-1 bg-green-50 rounded border border-green-200 hover:bg-green-100 transition-colors">
                                                                    <i class="fas fa-download mr-1"></i>Download
                                                                </a>
                                                            </div>
                                                        {% else %}
                                                            <span class="text-gray-400 text-xs">No document</span>
                                                        {% endif %}
                                                    </td>
                                                    <td class="px-4 py-4 text-sm text-gray-900 max-w-xs">
                                                        <div class="truncate" title="{{ leave.description }}">{{ leave.description }}</div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% else %}
                                    <div class="text-center py-12">
                                        <i class="fas fa-calendar-alt text-4xl text-gray-300 mb-4"></i>
                                        <h3 class="text-lg font-medium text-gray-800 mb-2">No Leave History</h3>
                                        <p class="text-gray-500">No leave records found for your team members.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Resigned Employees Tab -->
            <div id="resigned-employees" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-user-times text-red-600 mr-2"></i>Resigned Employees
                        </h2>
                        <p class="text-sm text-gray-600 mt-1">Employees who have left the organization</p>
                    </div>
                    <div class="p-6">
                        {% if resigned_employees %}
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Joining Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Resignation Date</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for employee in resigned_employees %}
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-4 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-8 w-8">
                                                        <div class="h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center">
                                                            <span class="text-xs font-medium text-gray-600">{{ employee.name[0]|upper if employee.name else employee.username[0]|upper }}</span>
                                                        </div>
                                                    </div>
                                                    <div class="ml-3">
                                                        <div class="text-sm font-medium text-gray-900">{{ employee.name or employee.username }}</div>
                                                        <div class="text-sm text-gray-500">{{ employee.username }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">{{ employee.role }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">{{ employee.joining_date or 'N/A' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">{{ employee.resigned_date or 'N/A' }}</td>
                                            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                                                <button class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 border border-blue-200 rounded hover:bg-blue-50 transition-colors" onclick="viewResignedEmployeeDetails('{{ employee.username }}')">
                                                    <i class="fas fa-eye mr-1"></i>View Details
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-12">
                                <i class="fas fa-user-check text-4xl text-green-300 mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-800 mb-2">No Resigned Employees</h3>
                                <p class="text-gray-500">All employees are currently active.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Employee Details Modal -->
<div id="employeeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Employee Details</h3>
                        <div class="mt-4">
                            <div id="employee-details-content" class="text-sm text-gray-500">
                                <!-- Employee details will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-colors" onclick="closeModal()">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Employee Modal - COMPLETE VERSION -->
<div id="editEmployeeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50" onclick="closeEditModalOnBackdrop(event)">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg shadow-xl transform transition-all w-full max-w-6xl max-h-[90vh] flex flex-col" onclick="event.stopPropagation()">
            <form method="post" action="{{ url_for('edit_employee_admin') }}" enctype="multipart/form-data" class="flex flex-col h-full" id="editEmployeeForm">
                <!-- Modal Header - Fixed -->
                <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0 bg-white">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-green-100">
                                <i class="fas fa-edit text-green-600"></i>
                            </div>
                            <h3 class="ml-3 text-lg font-medium text-gray-900">Edit Employee - Complete Details</h3>
                        </div>
                        <button type="button" onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 text-xl" tabindex="-1">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Body - SCROLLABLE with proper constraints -->
                <div class="flex-1 overflow-y-auto px-6 py-4 modal-scroll" style="max-height: calc(90vh - 140px);">
                    <div class="space-y-6">
                        <input type="hidden" name="employee_username" id="edit_employee_username">
                        
                        <!-- Basic Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-user text-blue-600 mr-2"></i>Basic Information
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                                    <input type="text" name="name" id="edit_name" class="form-input w-full rounded-lg border-gray-300" placeholder="Leave empty to keep current">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" name="email" id="edit_email" class="form-input w-full rounded-lg border-gray-300" placeholder="Leave empty to keep current">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                                    <select name="role" id="edit_role" class="form-select w-full rounded-lg border-gray-300">
                                        <option value="">Keep Current Role</option>
                                        <option value="Admin Manager">Admin Manager</option>
                                        <option value="Manager">Manager</option>
                                        <option value="Rm">RM</option>
                                        <option value="Employee">Employee</option>
                                        <option value="Intern">Intern</option>
                                        <option value="Lead">Lead</option>
                                        <option value="Product Owner">Product Owner</option>
                                        <option value="BDE Manager">BDE Manager</option>
                                        <option value="Lead Staffing Specialist">Lead Staffing Specialist</option>
                                        <option value="SAP Consultant">SAP Consultant</option>
                                        <option value="Contractor">Contractor</option>
                                        <option value="Hr & Finance Controller">HR & Finance Controller</option>
                                        <option value="Finance Manager">Finance Manager</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                                    <input type="password" name="password" id="edit_password" class="form-input w-full rounded-lg border-gray-300" placeholder="Leave empty to keep current password">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Reporting Manager</label>
                                    <select name="reporting_manager" id="edit_reporting_manager" class="form-select w-full rounded-lg border-gray-300">
                                        <option value="">Keep Current Manager</option>
                                        {% for manager in all_managers %}
                                        <option value="{{ manager.username }}">{{ manager.name }} ({{ manager.username }})</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Employment Details -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-briefcase text-green-600 mr-2"></i>Employment Details
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Joining Date</label>
                                    <input type="date" name="joining_date" id="edit_joining_date" class="form-input w-full rounded-lg border-gray-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Employment Type</label>
                                    <input type="text" 
                                           name="employment_type" 
                                           id="edit_employment_type" 
                                           class="form-input w-full rounded-lg border-gray-300" 
                                           placeholder="Enter employment type"
                                           list="employment-types-edit"
                                           onchange="toggleDurationFieldForEdit(this)">
                                    <datalist id="employment-types-edit">
                                        <option value="Fulltime">
                                        <option value="Contractual">
                                        <option value="Freelancer">
                                        <option value="Intern">
                                        <option value="Remote">
                                        <option value="Hybrid">
                                        <option value="Part-time">
                                        <option value="Consultant">
                                    </datalist>
                                </div>
                                <div id="edit_duration_field">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Duration (months)</label>
                                    <input type="number" name="duration" id="edit_duration" class="form-input w-full rounded-lg border-gray-300" placeholder="Contract duration">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Blood Group</label>
                                    <select name="blood_group" id="edit_blood_group" class="form-select w-full rounded-lg border-gray-300">
                                        <option value="">Keep Current</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-phone text-purple-600 mr-2"></i>Contact Information
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                                    <input type="tel" name="mobile_number" id="edit_mobile_number" class="form-input w-full rounded-lg border-gray-300" placeholder="Enter mobile number">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                                    <input type="tel" name="emergency_contact" id="edit_emergency_contact" class="form-input w-full rounded-lg border-gray-300" placeholder="Emergency contact number">
                                </div>
                            </div>
                        </div>

                        <!-- Asset Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-laptop text-indigo-600 mr-2"></i>Asset Information
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="edit_laptop_provided" name="laptop_provided" class="rounded border-gray-300 text-blue-600">
                                    <label for="edit_laptop_provided" class="ml-2 text-sm text-gray-700">Laptop Provided</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="edit_id_card_provided" name="id_card_provided" class="rounded border-gray-300 text-blue-600">
                                    <label for="edit_id_card_provided" class="ml-2 text-sm text-gray-700">ID Card Provided</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="edit_email_provided" name="email_provided" class="rounded border-gray-300 text-blue-600">
                                    <label for="edit_email_provided" class="ml-2 text-sm text-gray-700">Email Access Provided</label>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ID Card Details</label>
                                    <input type="text" name="id_card" id="edit_id_card" class="form-input w-full rounded-lg border-gray-300" placeholder="ID Card number or details">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Asset Details</label>
                                    <textarea name="asset_details" id="edit_asset_details" rows="2" class="form-textarea w-full rounded-lg border-gray-300" placeholder="Additional asset details"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Documents & Identification -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-id-card text-red-600 mr-2"></i>Documents & Identification
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Aadhaar Number</label>
                                    <input type="text" name="adhaar_number" id="edit_adhaar_number" class="form-input w-full rounded-lg border-gray-300" placeholder="Enter Aadhaar number" maxlength="12">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">PAN Number</label>
                                    <input type="text" name="pan_number" id="edit_pan_number" class="form-input w-full rounded-lg border-gray-300" placeholder="Enter PAN number" maxlength="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn URL</label>
                                    <input type="url" name="linkedin_url" id="edit_linkedin_url" class="form-input w-full rounded-lg border-gray-300" placeholder="https://linkedin.com/in/username">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload New Photo</label>
                                    <input type="file" name="photo" id="edit_photo" accept="image/*" class="form-input w-full rounded-lg border-gray-300">
                                    <p class="text-xs text-gray-500 mt-1">Upload new employee photo (JPG, PNG, max 5MB)</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Photo URL (Alternative)</label>
                                    <input type="url" name="photo_url" id="edit_photo_url" class="form-input w-full rounded-lg border-gray-300" placeholder="https://example.com/photo.jpg">
                                    <p class="text-xs text-gray-500 mt-1">Or provide photo URL</p>
                                </div>
                            </div>
                        </div>

                        <!-- Leave Balance Configuration -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-calendar-alt text-orange-600 mr-2"></i>Leave Balance Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Leaves</label>
                                    <input type="number" name="total_leaves" id="edit_total_leaves" class="form-input w-full rounded-lg border-gray-300" placeholder="Default: 36">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Sick Leaves</label>
                                    <input type="number" name="sick_total" id="edit_sick_total" class="form-input w-full rounded-lg border-gray-300" placeholder="Default: 12">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Paid Leaves</label>
                                    <input type="number" name="paid_total" id="edit_paid_total" class="form-input w-full rounded-lg border-gray-300" placeholder="Default: 18">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Casual Leaves</label>
                                    <input type="number" name="casual_total" id="edit_casual_total" class="form-input w-full rounded-lg border-gray-300" placeholder="Default: 6">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer - FIXED POSITION -->
                <div class="px-6 py-4 border-t border-gray-200 bg-white flex justify-end space-x-3 flex-shrink-0">
                    <button type="button" 
                            onclick="closeEditModal()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                        <i class="fas fa-save mr-2"></i>Update Employee
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Resigned Employee Details Modal -->
<div id="resignedEmployeeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fas fa-user-times text-red-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="resigned-modal-title">Resigned Employee Details</h3>
                        <div class="mt-4">
                            <div id="resigned-employee-details-content" class="text-sm text-gray-500">
                                <!-- Resigned employee details will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-colors" onclick="closeResignedModal()">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            
            // Update button styles
            tabButtons.forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-blue-600');
                btn.classList.add('text-gray-500', 'border-transparent');
            });
            
            button.classList.add('text-blue-600', 'border-blue-600');
            button.classList.remove('text-gray-500', 'border-transparent');
            
            // Update content visibility
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tabId).classList.remove('hidden');
        });
    });

    // Team history sub-tabs
    const teamTabButtons = document.querySelectorAll('.team-tab-button');
    const teamTabContents = document.querySelectorAll('.team-tab-content');
    
    teamTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            
            // Update button styles
            teamTabButtons.forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-blue-600');
                btn.classList.add('text-gray-500', 'border-transparent');
            });
            
            button.classList.add('text-blue-600', 'border-blue-600');
            button.classList.remove('text-gray-500', 'border-transparent');
            
            // Update content visibility
            teamTabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tabId).classList.remove('hidden');
        });
    });

    // Auto-hide flash messages after 5 seconds
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(message => {
        setTimeout(() => {
            message.style.transition = 'opacity 0.5s ease-out';
            message.style.opacity = '0';
            setTimeout(() => {
                message.remove();
            }, 500);
        }, 5000);
    });
});

function toggleDurationFieldForInput(inputElement) {
    const employmentType = inputElement.value.toLowerCase();
    const durationField = document.getElementById('duration-field') || document.getElementById('edit_duration_field');
    
    if (employmentType.includes('contractual') || 
        employmentType.includes('freelancer') || 
        employmentType.includes('intern')) {
        if (durationField) durationField.classList.remove('hidden');
    } else {
        if (durationField) durationField.classList.add('hidden');
    }
}

function toggleDurationFieldForEdit(inputElement) {
    const employmentType = inputElement.value.toLowerCase();
    const durationField = document.getElementById('edit_duration_field');
    
    if (employmentType.includes('contractual') || 
        employmentType.includes('freelancer') || 
        employmentType.includes('intern')) {
        if (durationField) durationField.classList.remove('hidden');
    } else {
        if (durationField) durationField.classList.add('hidden');
    }
}

// Enhanced Edit Employee Function
function editEmployee(username, name, email, role, mobile) {
    // Set basic fields only
    document.getElementById('edit_employee_username').value = username;
    document.getElementById('edit_name').value = name || '';
    document.getElementById('edit_email').value = email || '';
    document.getElementById('edit_role').value = role || '';
    document.getElementById('edit_mobile_number').value = mobile || '';
    
    // Fetch complete employee details to populate all fields
    fetch(`{{ url_for('get_employee_details_json') }}?username=â‚¹{username}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const employee = data.employee;
                
                // Populate all comprehensive fields with current values
                document.getElementById('edit_joining_date').value = employee.joining_date || '';
                document.getElementById('edit_employment_type').value = employee.employment_type || '';
                document.getElementById('edit_duration').value = employee.duration || '';
                document.getElementById('edit_blood_group').value = employee.blood_group || '';
                document.getElementById('edit_emergency_contact').value = employee.emergency_contact || '';
                document.getElementById('edit_reporting_manager').value = employee.reporting_manager || '';
                
                // Asset information
                document.getElementById('edit_laptop_provided').checked = employee.laptop_provided || false;
                document.getElementById('edit_id_card_provided').checked = employee.id_card_provided || false;
                document.getElementById('edit_email_provided').checked = employee.email_provided || false;
                document.getElementById('edit_id_card').value = employee.id_card || '';
                document.getElementById('edit_asset_details').value = employee.asset_details || '';
                
                // Documents & Identification
                document.getElementById('edit_adhaar_number').value = employee.adhaar_number || '';
                document.getElementById('edit_pan_number').value = employee.pan_number || '';
                document.getElementById('edit_linkedin_url').value = employee.linkedin_url || '';
                document.getElementById('edit_photo_url').value = employee.photo_url || '';
                
                // Leave balance fields
                document.getElementById('edit_total_leaves').value = employee.total_leaves || '';
                document.getElementById('edit_sick_total').value = employee.sick_total || '';
                document.getElementById('edit_paid_total').value = employee.paid_total || '';
                document.getElementById('edit_casual_total').value = employee.casual_total || '';
                
                console.log('All employee fields populated successfully');
            } else {
                console.error('Failed to fetch employee details:', data.message);
            }
        })
        .catch(error => {
            console.error('Error fetching employee details:', error);
        });
    
    document.getElementById('editEmployeeModal').classList.remove('hidden');
}

function closeEditModal() {
    document.getElementById('editEmployeeModal').classList.add('hidden');
}

function closeEditModalOnBackdrop(event) {
    if (event.target === event.currentTarget) {
        closeEditModal();
    }
}

// View Employee Details Function - WITH RM INFO
function viewEmployeeDetails(username) {
    fetch(`{{ url_for('get_employee_details_json') }}?username=â‚¹{username}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const employee = data.employee;
                const detailsHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Personal Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-user text-blue-600 mr-2"></i>Personal Information
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Username:</strong> â‚¹{employee.username}</div>
                                <div><strong>Full Name:</strong> â‚¹{employee.name || 'N/A'}</div>
                                <div><strong>Email:</strong> â‚¹{employee.email || 'N/A'}</div>
                                <div><strong>Role:</strong> â‚¹{employee.role || 'N/A'}</div>
                                <div><strong>Mobile:</strong> â‚¹{employee.mobile_number || 'N/A'}</div>
                                <div><strong>Emergency Contact:</strong> â‚¹{employee.emergency_contact || 'N/A'}</div>
                                <div><strong>Blood Group:</strong> â‚¹{employee.blood_group || 'N/A'}</div>
                            </div>
                        </div>
                        
                        <!-- Employment Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-briefcase text-green-600 mr-2"></i>Employment Information
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Employment Type:</strong> â‚¹{employee.employment_type || 'N/A'}</div>
                                <div><strong>Joining Date:</strong> â‚¹{employee.joining_date || 'N/A'}</div>
                                <div><strong>Status:</strong> â‚¹{employee.status || 'N/A'}</div>
                                <div><strong>Duration:</strong> â‚¹{employee.duration || 'N/A'}</div>
                            </div>
                        </div>
                        
                        <!-- Reporting Manager (RM) Details ONLY -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-user-tie text-blue-600 mr-2"></i>Reporting Manager (RM) Details
                            </h4>
                            <div class="space-y-2 text-sm">
                                â‚¹{employee.rm_username ? `
                                    <div><strong>RM Username:</strong> â‚¹{employee.rm_username}</div>
                                    <div><strong>RM Name:</strong> â‚¹{employee.rm_name || 'N/A'}</div>
                                    <div><strong>RM Role:</strong> â‚¹{employee.rm_role || 'N/A'}</div>
                                    <div><strong>RM Email:</strong> â‚¹{employee.rm_email || 'N/A'}</div>
                                ` : '<div class="text-gray-500 italic">No reporting manager (RM) assigned</div>'}
                            </div>
                        </div>
                        
                        <!-- Documents & Assets -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-file-alt text-purple-600 mr-2"></i>Documents & Assets
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Aadhaar Number:</strong> â‚¹{employee.adhaar_number || 'N/A'}</div>
                                <div><strong>PAN Number:</strong> â‚¹{employee.pan_number || 'N/A'}</div>
                                <div><strong>LinkedIn:</strong> â‚¹{employee.linkedin_url ? `<a href="â‚¹{employee.linkedin_url}" target="_blank" class="text-blue-600 hover:underline">â‚¹{employee.linkedin_url}</a>` : 'N/A'}</div>
                                <div><strong>ID Card:</strong> â‚¹{employee.id_card || 'N/A'}</div>
                                <div><strong>Laptop Provided:</strong> â‚¹{employee.laptop_provided ? 'Yes' : 'No'}</div>
                                <div><strong>ID Card Provided:</strong> â‚¹{employee.id_card_provided ? 'Yes' : 'No'}</div>
                                <div><strong>Email Access:</strong> â‚¹{employee.email_provided ? 'Yes' : 'No'}</div>
                            </div>
                        </div>
                        
                        <!-- Leave Balance -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-calendar-alt text-orange-600 mr-2"></i>Leave Balance
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Total Leaves:</strong> â‚¹{employee.total_leaves || 'N/A'}</div>
                                <div><strong>Sick Leaves:</strong> â‚¹{employee.sick_total || 'N/A'}</div>
                                <div><strong>Paid Leaves:</strong> â‚¹{employee.paid_total || 'N/A'}</div>
                                <div><strong>Casual Leaves:</strong> â‚¹{employee.casual_total || 'N/A'}</div>
                            </div>
                        </div>
                        
                        â‚¹{employee.asset_details ? `
                        <div class="bg-gray-50 p-4 rounded-lg md:col-span-2">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-laptop text-indigo-600 mr-2"></i>Asset Details
                            </h4>
                            <div class="text-sm">â‚¹{employee.asset_details}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    â‚¹{employee.photo_url ? `
                    <div class="mt-4 text-center">
                        <img src="â‚¹{employee.photo_url}" alt="â‚¹{employee.name || employee.username}" class="mx-auto h-32 w-32 rounded-full object-cover border-4 border-gray-200">
                    </div>
                    ` : ''}
                `;
                
                document.getElementById('employee-details-content').innerHTML = detailsHtml;
                document.getElementById('employeeModal').classList.remove('hidden');
            } else {
                alert('Failed to load employee details: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading employee details');
        });
}

function closeModal() {
    document.getElementById('employeeModal').classList.add('hidden');
}

// View Resigned Employee Details Function
function viewResignedEmployeeDetails(username) {
    fetch(`{{ url_for('get_employee_details_json') }}?username=â‚¹{username}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const employee = data.employee;
                const detailsHtml = `
                    <div class="bg-red-50 p-4 rounded-lg mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                            <span class="text-red-800 font-semibold">This employee has resigned</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Personal Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-user text-blue-600 mr-2"></i>Personal Information
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Username:</strong> â‚¹{employee.username}</div>
                                <div><strong>Full Name:</strong> â‚¹{employee.name || 'N/A'}</div>
                                <div><strong>Role:</strong> â‚¹{employee.role || 'N/A'}</div>
                                <div><strong>Email:</strong> â‚¹{employee.email || 'N/A'}</div>
                                <div><strong>Mobile:</strong> â‚¹{employee.mobile_number || 'N/A'}</div>
                            </div>
                        </div>
                        
                        <!-- Employment Dates -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-calendar text-green-600 mr-2"></i>Employment Period
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Joining Date:</strong> â‚¹{employee.joining_date || 'N/A'}</div>
                                <div><strong>Resignation Date:</strong> â‚¹{employee.resigned_date || 'N/A'}</div>
                                <div><strong>Employment Type:</strong> â‚¹{employee.employment_type || 'N/A'}</div>
                                <div><strong>Status:</strong> <span class="text-red-600 font-semibold">â‚¹{employee.status || 'Resigned'}</span></div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('resigned-employee-details-content').innerHTML = detailsHtml;
                document.getElementById('resignedEmployeeModal').classList.remove('hidden');
            } else {
                alert('Failed to load resigned employee details: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading resigned employee details');
        });
}

function closeResignedModal() {
    document.getElementById('resignedEmployeeModal').classList.add('hidden');
}

// Delete Employee Function
function deleteEmployee(username) {
    if (confirm(`Are you sure you want to delete employee: â‚¹{username}?\n\nThis action cannot be undone and will remove all employee data including work history, leave records, and personal information.`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("delete_employee_admin") }}';
        
        const usernameInput = document.createElement('input');
        usernameInput.type = 'hidden';
        usernameInput.name = 'username';
        usernameInput.value = username;
        
        form.appendChild(usernameInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Reject Work Function
function rejectWork(workId) {
    const reason = prompt('Please provide a reason for rejection:');
    if (reason && reason.trim()) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("reject_timesheet_action") }}';
        
        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = workId;
        
        const reasonInput = document.createElement('input');
        reasonInput.type = 'hidden';
        reasonInput.name = 'rejection_reason';
        reasonInput.value = reason.trim();
        
        form.appendChild(idInput);
        form.appendChild(reasonInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Reject Leave Function
function rejectLeave(leaveId) {
    const reason = prompt('Please provide a reason for rejection:');
    if (reason && reason.trim()) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("reject_leave_action") }}';
        
        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = leaveId;
        
        const reasonInput = document.createElement('input');
        reasonInput.type = 'hidden';
        reasonInput.name = 'rejection_reason';
        reasonInput.value = reason.trim();
        
        form.appendChild(idInput);
        form.appendChild(reasonInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Form validation for employee creation
document.addEventListener('DOMContentLoaded', function() {
    const createEmployeeForm = document.getElementById('createEmployeeForm');
    if (createEmployeeForm) {
        createEmployeeForm.addEventListener('submit', function(e) {
            const username = document.querySelector('input[name="username"]').value.trim();
            const password = document.querySelector('input[name="password"]').value;
            
            if (username.length < 3) {
                e.preventDefault();
                alert('Username must be at least 3 characters long');
                return;
            }
            
            if (password.length < 6) {
                e.preventDefault();
                alert('Password must be at least 6 characters long');
                return;
            }
        });
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + K to focus search
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        const searchInput = document.getElementById('employee-search');
        if (searchInput) {
            searchInput.focus();
        }
    }
    
    // Escape to close modals
    if (e.key === 'Escape') {
        closeModal();
        closeEditModal();
        closeResignedModal();
    }
});

// Notification system
function showNotification(message, type = 'info', duration = 3000) {
    const container = document.getElementById('notification-container');
    if (!container) return;
    
    const notification = document.createElement('div');
    
    const bgColor = {
        'success': 'bg-green-500',
        'error': 'bg-red-500',
        'warning': 'bg-yellow-500',
        'info': 'bg-blue-500'
    }[type] || 'bg-blue-500';
    
    notification.className = `â‚¹{bgColor} text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
    notification.innerHTML = `
        <div class="flex items-center justify-between">
            <span>â‚¹{message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    container.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.classList.remove('translate-x-full', 'opacity-0');
    }, 100);
    
    // Auto remove
    setTimeout(() => {
        notification.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 300);
    }, duration);
}
</script>

<!-- Custom Styles for Enhanced UI -->
<style>
.form-input, .form-select, .form-textarea {
    display: block;
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    line-height: 1.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.tab-button.active {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border-color: #3b82f6;
}

.flash-message {
    animation: slideInDown 0.5s ease-out;
}

@keyframes slideInDown {
    from {
        transform: translateY(-100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.hover-scale:hover {
    transform: scale(1.02);
    transition: transform 0.2s ease-in-out;
}

.shadow-hover:hover {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    transition: box-shadow 0.3s ease-in-out;
}

/* Custom scrollbar for modal content */
.modal-scroll::-webkit-scrollbar {
    width: 6px;
}

.modal-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.modal-scroll::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.modal-scroll::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Enhanced table styling */
.table-hover tbody tr:hover {
    background-color: #f8fafc;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.transition-colors {
    transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, color 0.15s ease-in-out;
}

.overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
}

.overflow-x-auto::-webkit-scrollbar { height: 6px; }
.overflow-x-auto::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
.overflow-x-auto::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
.overflow-x-auto::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

.max-w-xs {
    max-width: 20rem;
}

.truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Responsive improvements */
@media (max-width: 768px) {
    .tab-navigation {
        overflow-x: auto;
        white-space: nowrap;
    }
    
    .tab-button {
        min-width: 120px;
    }
    
    .grid-responsive {
        grid-template-columns: 1fr;
    }
    
    .grid-cols-4 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    
    .grid-cols-3 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }
}

/* Print styles */
@media print {
    .no-print, .tab-navigation, button, .modal {
        display: none !important;
    }
    
    .tab-content {
        display: block !important;
    }
    
    body {
        font-size: 12px;
    }
    
    table {
        page-break-inside: avoid;
    }
}
</style>

<!-- Notification System -->
<div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2">
    <!-- Notifications will be dynamically added here -->
</div>

{% endblock %}

