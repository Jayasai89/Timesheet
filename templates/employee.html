{% extends "base.html" %}
{% block content %}

<!-- Employee Dashboard Header -->
<div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg p-6 text-white mb-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold">{{ user }} ({{ role }})</h1>
            <p class="text-blue-100 mt-1">Employee Dashboard</p>
        </div>
        <div class="flex items-center space-x-4">
            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                <p class="text-sm opacity-90">Today</p>
                <p class="text-lg font-semibold">{{ today }}</p>
            </div>
            <button onclick="window.history.back()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
            <a href="{{ url_for('logout') }}" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
        </div>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="space-y-2 mb-6">
            {% for message in messages %}
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                    <span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="this.parentElement.style.display='none'">Ã—</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<!-- Stats Cards -->
<div class="grid grid-cols-3 gap-4 mb-6">
    <div class="bg-green-500 rounded-xl p-4 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-sm font-medium opacity-90">Sick Leave</h3>
                <h3 class="text-3xl font-bold">{{ remaining_leaves.sick if remaining_leaves else 11 }}</h3>
                <p class="text-green-100 text-sm">days available</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-2">
                <i class="fas fa-user-md text-2xl"></i>
            </div>
        </div>
    </div>

    <div class="bg-blue-500 rounded-xl p-4 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-sm font-medium opacity-90">Paid Leave</h3>
                <h3 class="text-3xl font-bold">{{ remaining_leaves.paid if remaining_leaves else 18 }}</h3>
                <p class="text-blue-100 text-sm">days available</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-2">
                <i class="fas fa-plane text-2xl"></i>
            </div>
        </div>
    </div>

    <div class="bg-purple-500 rounded-xl p-4 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-sm font-medium opacity-90">Casual Leave</h3>
                <h3 class="text-3xl font-bold">{{ remaining_leaves.casual if remaining_leaves else 6 }}</h3>
                <p class="text-purple-100 text-sm">days available</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-2">
                <i class="fas fa-coffee text-2xl"></i>
            </div>
        </div>
    </div>
</div>

<!-- Main Container with Alpine.js -->
<div x-data="{
    activeTab: '{{ request.args.get('activeTab', 'timesheet') }}',
    teamTab: '{{ request.args.get('teamTab', 'work') }}'
}" class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
    <!-- Tab Navigation -->
    <div class="border-b border-gray-200">
        <nav class="flex space-x-8 px-6" aria-label="Tabs">
            <button 
                :class="activeTab === 'timesheet' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'timesheet'"
            >
                <i class="fas fa-clock mr-2"></i>Timesheet
            </button>
            <button 
                :class="activeTab === 'leave' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'leave'"
            >
                <i class="fas fa-calendar-alt mr-2"></i>Leave Management
            </button>
            <button 
                :class="activeTab === 'work' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'work'"
            >
                <i class="fas fa-tasks mr-2"></i>Work Assignment
            </button>
            <button 
                :class="activeTab === 'history' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'history'"
            >
                <i class="fas fa-history mr-2"></i>My History
            </button>
            {% if is_rm %}
            <button 
                :class="activeTab === 'team-approvals' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'team-approvals'"
            >
                <i class="fas fa-users-check mr-2"></i>Team Approvals
                {% if pending_timesheets or pending_leaves %}
                <span class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1">
                    {{ (pending_timesheets|length + pending_leaves|length) }}
                </span>
                {% endif %}
            </button>
            <button 
                :class="activeTab === 'team-history' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300'"
                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
                @click="activeTab = 'team-history'"
            >
                <i class="fas fa-users-cog mr-2"></i>Team History
            </button>
            {% endif %}
        </nav>
    </div>

    <!-- Tab Content -->
    <div class="p-6">
        <!-- Timesheet Tab -->
        <div x-show="activeTab === 'timesheet'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Content Area -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Timesheet Submission -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>Submit Today's Timesheet
                            </h2>
                        </div>
                        <div class="p-6">
                            <form method="post" action="{{ url_for('submit_timesheet_action') }}" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Project</label>
                                        <select name="project" required class="form-select w-full rounded-lg border-gray-300">
                                            <option value="">Select Project</option>
                                            {% if proj_list %}
                                                {% for project in proj_list %}
                                                    <option value="{{ project }}">{{ project }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                        <input type="date" name="work_date" value="{{ today }}" required
                                               class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                        <input type="time" name="start_t" required
                                               class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                                        <input type="time" name="end_t" required
                                               class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Break (hrs)</label>
                                        <input type="number" name="brk" value="0" step="0.5" min="0" max="8"
                                               class="form-input w-full rounded-lg border-gray-300">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Description</label>
                                    <textarea name="desc" rows="3" placeholder="Describe the work completed today..." required
                                              class="form-textarea w-full rounded-lg border-gray-300"></textarea>
                                </div>
                                
                                <button type="submit" 
                                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-paper-plane mr-2"></i>Submit
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="space-y-6">
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-bell text-yellow-600 mr-2"></i>Recent Activity
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="space-y-3">
                                {% if work_history_rows %}
                                    {% for entry in work_history_rows[:3] %}
                                    <div class="flex items-center space-x-3 text-sm">
                                        <div class="flex-shrink-0">
                                            {% if entry.rm_status == 'Approved' %}
                                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                            {% elif entry.rm_status == 'Pending' %}
                                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                            {% else %}
                                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                            {% endif %}
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-gray-800">Timesheet {{ entry.rm_status or 'Submitted' }}</p>
                                            <p class="text-gray-500 text-xs">{{ entry.work_date|dateformat or 'N/A' }}</p>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="text-center py-4">
                                        <i class="fas fa-bell text-2xl text-gray-300 mb-2"></i>
                                        <p class="text-gray-500 text-sm">No recent activity</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fas fa-bolt text-yellow-600 mr-2"></i>Quick Actions
                            </h2>
                        </div>
                        <div class="p-6 space-y-3">
                            <button onclick="downloadReport()" 
                                    class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <i class="fas fa-download text-gray-600 mr-3"></i>
                                    <span class="text-sm font-medium text-gray-700">Download Report</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                            
                            <button onclick="changePassword()" 
                                    class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <i class="fas fa-lock text-gray-600 mr-3"></i>
                                    <span class="text-sm font-medium text-gray-700">Change Password</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                            
                            <button onclick="viewProfile()" 
                                    class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                                <div class="flex items-center">
                                    <i class="fas fa-user text-gray-600 mr-3"></i>
                                    <span class="text-sm font-medium text-gray-700">View Profile</span>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leave Management Tab -->
        <div x-show="activeTab === 'leave'" x-cloak x-transition>
            <div class="max-w-md mx-auto">
                <!-- Leave Request Form -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-calendar-plus text-purple-600 mr-2"></i>Request Leave
                        </h2>
                    </div>
                    <div class="p-6">
                        <form method="post" action="{{ url_for('request_leave_action') }}" enctype="multipart/form-data" 
                              x-data="{ leaveType: '', showDocUpload: false, startDate: '', endDate: '' }" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type</label>
                                <select name="leave_type" x-model="leaveType" required
                                        @change="showDocUpload = (leaveType === 'Sick')"
                                        class="form-select w-full rounded-lg border-gray-300">
                                    <option value="">Select type</option>
                                    <option value="Sick">Sick ({{ remaining_leaves.sick if remaining_leaves else 0 }} left)</option>
                                    <option value="Vacation">Vacation ({{ remaining_leaves.paid if remaining_leaves else 0 }} left)</option>
                                    <option value="Personal">Personal ({{ remaining_leaves.paid if remaining_leaves else 0 }} left)</option>
                                    <option value="Casual">Casual ({{ remaining_leaves.casual if remaining_leaves else 0 }} left)</option>
                                    <option value="Other">Other ({{ remaining_leaves.casual if remaining_leaves else 0 }} left)</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">From</label>
                                    <input type="date" name="start_d" x-model="startDate" required
                                           class="form-input w-full rounded-lg border-gray-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">To</label>
                                    <input type="date" name="end_d" x-model="endDate" required
                                           class="form-input w-full rounded-lg border-gray-300">
                                </div>
                            </div>
                            
                            <div x-show="startDate && endDate" class="text-sm text-gray-600 bg-gray-50 p-2 rounded">
                                <span x-text="startDate && endDate ? 'Duration: ' + (Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1) + ' day(s)' : ''"></span>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Reason</label>
                                <textarea name="description" rows="3" placeholder="Brief reason for leave..." required
                                          class="form-textarea w-full rounded-lg border-gray-300"></textarea>
                            </div>
                            
                            <div x-show="showDocUpload" x-transition class="bg-blue-50 p-3 rounded-lg">
                                <label class="block text-sm font-medium text-blue-800 mb-2">Medical Certificate</label>
                                <input type="file" name="doc" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                       class="form-input w-full text-sm rounded-lg border-blue-300">
                                <p class="text-xs text-blue-600 mt-1">Required for sick leave > 2 days</p>
                            </div>
                            
                            <button type="submit" 
                                    class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                <i class="fas fa-paper-plane mr-2"></i>Submit Request
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Work Assignment Tab -->
        <div x-show="activeTab === 'work'" x-cloak x-transition>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-tasks text-orange-600 mr-2"></i>Assigned Work
                    </h2>
                </div>
                <div class="p-6">
                    {% if assigned_work %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned By</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Task Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for work in assigned_work %}
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                            #{{ work.id }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-medium">
                                            {{ work.assigned_by }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                <i class="fas fa-project-diagram mr-1"></i>
                                                {{ work.project_name or 'General' }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                                            <div class="truncate" title="{{ work.task_desc }}">
                                                {{ work.task_desc }}
                                            </div>
                                            {% if work.task_desc|length > 50 %}
                                                <span class="text-xs text-gray-500 cursor-pointer" onclick="this.previousElementSibling.classList.toggle('truncate')">
                                                    Click to expand
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if work.start_date %}
                                                <div class="flex items-center">
                                                    <i class="fas fa-calendar-plus text-green-500 mr-1"></i>
                                                    {{ work.start_date|dateformat }}
                                                </div>
                                            {% else %}
                                                <span class="text-gray-400">Not set</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if work.due_date %}
                                                <div class="flex items-center">
                                                    <i class="fas fa-calendar-times text-red-500 mr-1"></i>
                                                    {{ work.due_date|dateformat }}
                                                </div>
                                            {% else %}
                                                <span class="text-gray-400">No deadline</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                <i class="fas fa-tasks mr-1"></i>Active
                                            </span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Summary Statistics -->
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-tasks text-blue-600 text-lg"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-blue-800">Total Tasks</p>
                                        <p class="text-lg font-semibold text-blue-900">{{ assigned_work|length }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-check-circle text-green-600 text-lg"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-green-800">Active Tasks</p>
                                        <p class="text-lg font-semibold text-green-900">{{ assigned_work|length }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-orange-50 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-clock text-orange-600 text-lg"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-orange-800">Due Soon</p>
                                        <p class="text-lg font-semibold text-orange-900">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <i class="fas fa-clipboard-list text-4xl text-gray-300 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-800 mb-2">No Work Assignments</h3>
                            <p class="text-gray-500">You don't have any assigned tasks at the moment.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            {% if is_rm %}
            <!-- RM Work Assignment Form - Shows ALL team members -->
            <div class="mt-8 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-user-plus text-green-600 mr-3"></i>
                    Assign Work to Team ({{ employees|length }} members available)
                </h3>
                
                <form method="post" action="{{ url_for('rm_assign_work_action') }}" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Assign to Team Members 
                                <span class="text-xs text-gray-500">({{ employees|length }} available)</span>
                            </label>
                            <div class="relative">
                                <select name="employee_username" multiple class="form-select w-full rounded-lg border-gray-300 h-40" required>
                                    {% if employees %}
                                        {% for employee in employees %}
                                            <option value="{{ employee.username }}" title="{{ employee.role }}">
                                                {{ employee.name or employee.username }} ({{ employee.username }})
                                                {% if employee.role %} - {{ employee.role }}{% endif %}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="" disabled>No team members found</option>
                                    {% endif %}
                                </select>
                                <p class="text-xs text-gray-500 mt-1">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Hold Ctrl/Cmd to select multiple employees. Showing all team members in your hierarchy.
                                </p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Project</label>
                            <select name="project_name" class="form-select w-full rounded-lg border-gray-300">
                                <option value="">Select Project (Optional)</option>
                                {% for project in proj_list %}
                                    <option value="{{ project }}">{{ project }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Due Date</label>
                            <input type="date" name="due_date" class="form-input w-full rounded-lg border-gray-300">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Priority</label>
                            <select name="priority" class="form-select w-full rounded-lg border-gray-300">
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Task Description</label>
                        <textarea name="task_desc" rows="3" placeholder="Describe the task..." required
                                  class="form-textarea w-full rounded-lg border-gray-300"></textarea>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg">
                            <i class="fas fa-user-plus mr-2"></i>Assign Work to Selected Members
                        </button>
                    </div>
                </form>
            </div>
            {% endif %}
        </div>

        <!-- My History Tab -->
        <div x-show="activeTab === 'history'" x-cloak x-transition>
            <div class="space-y-6">
                <!-- Work History Table -->
                {% if work_history_rows %}
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-history text-green-600 mr-2"></i>My Work History
                        </h2>
                    </div>
                    <div class="p-6 overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    {% for col in work_history_cols %}
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        {{ col.replace('_', ' ').title() }}
                                    </th>
                                    {% endfor %}
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for row in work_history_rows %}
                                <tr class="hover:bg-gray-50">
                                    {% for col in work_history_cols %}
                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {% if col == 'rm_status' %}
                                            {% if row[col] == 'Approved' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                    <i class="fas fa-check mr-1"></i>Approved
                                                </span>
                                            {% elif row[col] == 'Pending' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">
                                                    <i class="fas fa-clock mr-1"></i>Pending
                                                </span>
                                            {% elif row[col] == 'Rejected' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">
                                                    <i class="fas fa-times mr-1"></i>Rejected
                                                </span>
                                            {% else %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded-full">
                                                    <i class="fas fa-question mr-1"></i>{{ row[col] or 'Unknown' }}
                                                </span>
                                            {% endif %}
                                        {% elif col in ['work_date', 'start_date', 'end_date'] %}
                                            {{ row[col]|dateformat or '' }}
                                        {% elif col == 'overtime_hours' and row[col] and row[col] > 0 %}
                                            <span class="font-medium text-orange-600">{{ row[col] }}h</span>
                                        {% elif col == 'break_hours' %}
                                            {{ row[col] or 0 }}h
                                        {% else %}
                                            {{ row[col] or '' }}
                                        {% endif %}
                                    </td>
                                    {% endfor %}
                                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                                        {% if row.rm_status == 'Rejected' %}
                                            <a href="{{ url_for('edit_timesheet_form', timesheet_id=row.id) }}" 
                                               class="text-blue-600 hover:text-blue-800 text-xs bg-blue-100 px-2 py-1 rounded">
                                                <i class="fas fa-edit mr-1"></i>Resubmit
                                            </a>
                                        {% elif row.rm_status == 'Pending' %}
                                            <div class="flex space-x-2">
                                                <a href="{{ url_for('edit_timesheet_form', timesheet_id=row.id) }}" 
                                                   class="text-blue-600 hover:text-blue-800 text-xs bg-blue-100 px-2 py-1 rounded">
                                                    <i class="fas fa-edit mr-1"></i>Edit
                                                </a>
                                                <form method="post" action="{{ url_for('delete_timesheet') }}" style="display:inline;">
                                                    <input type="hidden" name="timesheet_id" value="{{ row.id }}">
                                                    <button type="submit" class="text-red-600 hover:text-red-800 text-xs bg-red-100 px-2 py-1 rounded"
                                                            onclick="return confirm('Are you sure you want to delete this timesheet?')">
                                                        <i class="fas fa-trash mr-1"></i>Delete
                                                    </button>
                                                </form>
                                            </div>
                                        {% else %}
                                            <span class="text-xs text-gray-400">No actions</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                <!-- Leave History Table -->
                {% if leave_rows %}
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-calendar-alt text-indigo-600 mr-2"></i>My Leave History
                        </h2>
                    </div>
                    <div class="p-6 overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    {% for col in leave_cols %}
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        {{ col.replace('_', ' ').title() }}
                                    </th>
                                    {% endfor %}
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for row in leave_rows %}
                                <tr class="hover:bg-gray-50">
                                    {% for col in leave_cols %}
                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {% if col == 'rm_status' %}
                                            {% if row[col] == 'Approved' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                    <i class="fas fa-check mr-1"></i>Approved
                                                </span>
                                            {% elif row[col] == 'Pending' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">
                                                    <i class="fas fa-clock mr-1"></i>Pending
                                                </span>
                                            {% elif row[col] == 'Rejected' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">
                                                    <i class="fas fa-times mr-1"></i>Rejected
                                                </span>
                                            {% else %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded-full">
                                                    <i class="fas fa-question mr-1"></i>{{ row[col] or 'Unknown' }}
                                                </span>
                                            {% endif %}
                                        {% elif col == 'leave_type' %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                {% if row[col] == 'Sick' %}bg-green-100 text-green-800
                                                {% elif row[col] in ['Vacation', 'Personal'] %}bg-blue-100 text-blue-800
                                                {% elif row[col] == 'Casual' %}bg-purple-100 text-purple-800
                                                {% endif %}">
                                                {{ row[col] }}
                                            </span>
                                        {% elif col in ['start_date', 'end_date'] %}
                                            {{ row[col]|dateformat or '' }}
                                        {% else %}
                                            {{ row[col] or '' }}
                                        {% endif %}
                                    </td>
                                    {% endfor %}
                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {% if row.start_date and row.end_date %}
                                            {% set duration = ((row.end_date|dateformat|strptime('%Y-%m-%d')) - (row.start_date|dateformat|strptime('%Y-%m-%d'))).days + 1 %}
                                            <span class="font-medium">{{ duration }} day(s)</span>
                                        {% else %}
                                            <span class="text-gray-500">N/A</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                                        {% if row.rm_status == 'Rejected' %}
                                            <a href="{{ url_for('edit_leave_form', leave_id=row.id) }}" 
                                               class="text-blue-600 hover:text-blue-800 text-xs bg-blue-100 px-2 py-1 rounded">
                                                <i class="fas fa-edit mr-1"></i>Resubmit
                                            </a>
                                        {% elif row.rm_status == 'Pending' %}
                                            <div class="flex space-x-2">
                                                <a href="{{ url_for('edit_leave_form', leave_id=row.id) }}" 
                                                   class="text-blue-600 hover:text-blue-800 text-xs bg-blue-100 px-2 py-1 rounded">
                                                    <i class="fas fa-edit mr-1"></i>Edit
                                                </a>
                                                <form method="post" action="{{ url_for('withdraw_leave') }}" style="display:inline;">
                                                    <input type="hidden" name="leave_id" value="{{ row.id }}">
                                                    <button type="submit" class="text-red-600 hover:text-red-900 text-xs bg-red-100 px-2 py-1 rounded"
                                                            onclick="return confirm('Are you sure you want to withdraw this leave request?')">
                                                        <i class="fas fa-times mr-1"></i>Withdraw
                                                    </button>
                                                </form>
                                            </div>
                                        {% elif row.rm_status == 'Approved' and not row.cancellation_requested %}
                                            <form method="post" action="{{ url_for('request_leave_cancellation') }}" style="display:inline;">
                                                <input type="hidden" name="leave_id" value="{{ row.id }}">
                                                <button type="submit" class="text-orange-600 hover:text-orange-900 text-xs bg-orange-100 px-2 py-1 rounded">
                                                    <i class="fas fa-undo mr-1"></i>Request Cancel
                                                </button>
                                            </form>
                                        {% elif row.cancellation_requested %}
                                            <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded">
                                                <i class="fas fa-hourglass-half mr-1"></i>Cancel Pending
                                            </span>
                                        {% else %}
                                            <span class="text-xs text-gray-400">No actions</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Team Approvals Tab (Only for RMs) - PENDING ITEMS ONLY -->
        {% if is_rm %}
        <div x-show="activeTab === 'team-approvals'" x-cloak x-transition>
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-users-check text-indigo-600 mr-3"></i>
                Team Approvals - Pending Items Only
                {% if pending_timesheets or pending_leaves %}
                <span class="ml-2 bg-red-100 text-red-800 text-sm font-medium px-3 py-1 rounded-full">
                    {{ (pending_timesheets|length + pending_leaves|length) }} pending
                </span>
                {% endif %}
            </h2>

            <div class="space-y-8">
                <!-- Check if user actually has pending approvals -->
                {% if pending_timesheets or pending_leaves %}
                    
                    <!-- Pending Timesheet Approvals -->
                    {% if pending_timesheets %}
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-yellow-50">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-clock text-yellow-600 mr-2"></i>
                                Pending Timesheet Approvals
                                <span class="ml-2 bg-yellow-100 text-yellow-800 text-sm font-medium px-2 py-1 rounded-full">
                                    {{ pending_timesheets|length }}
                                </span>
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">These timesheets are waiting for your approval</p>
                        </div>
                        <div class="overflow-x-auto" style="max-height: 24rem;">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for work in pending_timesheets %}
                                    <tr class="hover:bg-yellow-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">
                                            <i class="fas fa-user mr-1"></i>{{ work.username }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <i class="fas fa-calendar mr-1"></i>{{ work.work_date|dateformat }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">
                                                {{ work.project_name or 'General' }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            <div class="max-w-xs truncate" title="{{ work.work_desc }}">
                                                {{ work.work_desc[:100] }}{% if work.work_desc|length > 100 %}...{% endif %}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span class="font-bold text-green-600">{{ work.hours }}h</span>
                                            {% if work.break_hours %}
                                            <br><span class="text-xs text-gray-500">Break: {{ work.break_hours }}h</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex space-x-2">
                                                <form method="post" action="{{ url_for('approve_timesheet_action') }}" style="display: inline;">
                                                    <input type="hidden" name="id" value="{{ work.id }}">
                                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white text-xs px-3 py-2 rounded-md shadow-sm transition-all duration-200 transform hover:scale-105">
                                                        <i class="fas fa-check mr-1"></i>Approve
                                                    </button>
                                                </form>
                                                <button onclick="showRejectModal('timesheet', {{ work.id }})" 
                                                        class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-2 rounded-md shadow-sm transition-all duration-200 transform hover:scale-105">
                                                    <i class="fas fa-times mr-1"></i>Reject
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Pending Leave Approvals -->
                    {% if pending_leaves %}
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200 bg-blue-50">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-calendar-alt text-blue-600 mr-2"></i>
                                Pending Leave Approvals
                                <span class="ml-2 bg-blue-100 text-blue-800 text-sm font-medium px-2 py-1 rounded-full">
                                    {{ pending_leaves|length }}
                                </span>
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">These leave requests are waiting for your approval</p>
                        </div>
                        <div class="overflow-x-auto" style="max-height: 24rem;">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Leave Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reason</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for leave in pending_leaves %}
                                    <tr class="hover:bg-blue-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">
                                            <i class="fas fa-user mr-1"></i>{{ leave.username }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full
                                                {% if leave.leave_type == 'Sick' %}bg-red-100 text-red-800
                                                {% elif leave.leave_type in ['Vacation', 'Personal'] %}bg-blue-100 text-blue-800
                                                {% else %}bg-purple-100 text-purple-800{% endif %}">
                                                <i class="fas fa-calendar mr-1"></i>{{ leave.leave_type }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <i class="fas fa-play text-green-500 mr-1"></i>{{ leave.start_date|dateformat }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <i class="fas fa-stop text-red-500 mr-1"></i>{{ leave.end_date|dateformat }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if leave.duration_days %}
                                                <span class="font-bold text-orange-600">{{ leave.duration_days }} day(s)</span>
                                            {% else %}
                                                <span class="text-gray-500">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            <div class="max-w-xs truncate" title="{{ leave.description }}">
                                                {{ leave.description[:50] }}{% if leave.description|length > 50 %}...{% endif %}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex space-x-2">
                                                <form method="post" action="{{ url_for('approve_leave_action') }}" style="display: inline;">
                                                    <input type="hidden" name="id" value="{{ leave.id }}">
                                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white text-xs px-3 py-2 rounded-md shadow-sm transition-all duration-200 transform hover:scale-105">
                                                        <i class="fas fa-check mr-1"></i>Approve
                                                    </button>
                                                </form>
                                                <button onclick="showRejectModal('leave', {{ leave.id }})" 
                                                        class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-2 rounded-md shadow-sm transition-all duration-200 transform hover:scale-105">
                                                    <i class="fas fa-times mr-1"></i>Reject
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}

                {% else %}
                    <!-- No Pending Approvals - Enhanced Message -->
                    <div class="text-center py-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                        <div class="max-w-md mx-auto">
                            <i class="fas fa-check-double text-6xl text-gray-300 mb-6"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-3">All Clear! ðŸŽ‰</h3>
                            <p class="text-gray-500 mb-4">No pending approvals at the moment.</p>
                            
                            {% if not employees or employees|length == 0 %}
                            <div class="bg-yellow-100 border border-yellow-300 rounded-lg p-4 mb-4">
                                <p class="text-yellow-800 text-sm">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    <strong>Note:</strong> You don't seem to have any team members assigned to you yet. 
                                    Contact your admin to set up your team hierarchy.
                                </p>
                            </div>
                            {% else %}
                            <div class="bg-green-100 border border-green-300 rounded-lg p-4">
                                <p class="text-green-800 text-sm">
                                    <i class="fas fa-users mr-1"></i>
                                    You're managing <strong>{{ employees|length }}</strong> team member(s). 
                                    All their submissions are up to date!
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Team History Tab (Only for RMs) - ALL HISTORICAL RECORDS -->
        {% if is_rm %}
        <div x-show="activeTab === 'team-history'" x-cloak x-transition>
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-users-cog text-purple-600 mr-3"></i>
                Team History - Complete Historical Records
            </h2>

            <!-- Nested Tab Navigation for Team History -->
            <div class="flex space-x-4 border-b border-gray-200 mb-6">
                <button @click="teamTab='work'" 
                        :class="teamTab === 'work' ? 'border-b-2 border-purple-600 font-semibold text-purple-600' : 'text-gray-500 hover:text-gray-700'" 
                        class="pb-2 px-4 py-2 text-sm font-medium transition-colors">
                    <i class="fas fa-briefcase mr-2"></i>Team Work History
                    <span class="ml-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                        {{ employee_history_rows|length if employee_history_rows else 0 }}
                    </span>
                </button>
                <button @click="teamTab='leave'" 
                        :class="teamTab === 'leave' ? 'border-b-2 border-purple-600 font-semibold text-purple-600' : 'text-gray-500 hover:text-gray-700'" 
                        class="pb-2 px-4 py-2 text-sm font-medium transition-colors">
                    <i class="fas fa-calendar-times mr-2"></i>Team Leave History
                    <span class="ml-2 bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">
                        {{ team_leaves|length if team_leaves else 0 }}
                    </span>
                </button>
            </div>

            <div class="space-y-8">
                <!-- Team Work History -->
                <div x-show="teamTab === 'work'" x-transition>
                    <!-- Filter Form for Team Work History -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-filter mr-2"></i>Filter Team Work History
                        </h4>
                        <form method="GET" action="{{ url_for('dashboard') }}" class="grid grid-cols-1 md:grid-cols-7 gap-3">
                            <!-- Maintain active tab state -->
                            <input type="hidden" name="activeTab" value="team-history">
                            <input type="hidden" name="teamTab" value="work">
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">From Date</label>
                                <input type="date" name="team_work_start" value="{{ team_start }}"
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">To Date</label>
                                <input type="date" name="team_work_end" value="{{ team_end }}"
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Team Member</label>
                                <select name="team_work_emp" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Team Members</option>
                                    {% if employees %}
                                        {% for employee in employees %}
                                            <option value="{{ employee.username }}" 
                                                    {% if team_user == employee.username %}selected{% endif %}>
                                                {{ employee.name or employee.username }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Project</label>
                                <select name="team_work_proj" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Projects</option>
                                    {% for project in proj_list %}
                                        <option value="{{ project }}" 
                                                {% if team_proj == project %}selected{% endif %}>
                                            {{ project }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
                                <input type="text" name="team_work_desc" value="{{ team_desc }}" 
                                       placeholder="Search description..."
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                                <select name="team_work_status" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Status</option>
                                    <option value="Pending" {% if team_status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="Approved" {% if team_status == 'Approved' %}selected{% endif %}>Approved</option>
                                    <option value="Rejected" {% if team_status == 'Rejected' %}selected{% endif %}>Rejected</option>
                                </select>
                            </div>
                            
                            <div class="flex items-end space-x-2">
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center">
                                    <i class="fas fa-search mr-1"></i>Apply Filters
                                </button>
                                <a href="{{ url_for('dashboard', activeTab='team-history', teamTab='work') }}" 
                                   class="bg-gray-500 hover:bg-gray-600 text-white text-sm px-4 py-2 rounded flex items-center">
                                    <i class="fas fa-redo mr-1"></i>Clear All
                                </a>
                            </div>
                        </form>
                        
                        <!-- Show active filters -->
                        {% if team_start or team_end or team_user or team_proj or team_desc or team_status %}
                        <div class="mt-3 p-2 bg-blue-50 rounded">
                            <p class="text-xs text-blue-800 font-medium mb-1">Active Filters:</p>
                            <div class="flex flex-wrap gap-2">
                                {% if team_start %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    From: {{ team_start }}
                                </span>
                                {% endif %}
                                {% if team_end %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    To: {{ team_end }}
                                </span>
                                {% endif %}
                                {% if team_user %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Employee: {{ team_user }}
                                </span>
                                {% endif %}
                                {% if team_proj %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Project: {{ team_proj }}
                                </span>
                                {% endif %}
                                {% if team_desc %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Description: {{ team_desc }}
                                </span>
                                {% endif %}
                                {% if team_status %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Status: {{ team_status }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    {% if employee_history_rows %}
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-clock text-green-600 mr-2"></i>
                                Complete Team Timesheet History
                                <span class="ml-2 bg-green-100 text-green-800 text-sm font-medium px-2 py-1 rounded-full">
                                    {{ employee_history_rows|length }} records found
                                </span>
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">All timesheet submissions from your team members</p>
                        </div>
                        <div class="overflow-x-auto" style="max-height: 28rem;">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Break</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Overtime</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for work in employee_history_rows %}
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">
                                            {{ work.username }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ work.work_date|dateformat }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ work.project_name or 'N/A' }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span class="font-medium">{{ work.hours }}h</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ work.break_hours or 0 }}h
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if work.overtime_hours and work.overtime_hours > 0 %}
                                                <span class="font-medium text-orange-600">{{ work.overtime_hours }}h</span>
                                            {% else %}
                                                <span class="text-gray-400">0h</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            <div class="max-w-xs truncate" title="{{ work.work_desc }}">
                                                {{ work.work_desc[:80] }}{% if work.work_desc|length > 80 %}...{% endif %}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            {% if work.rm_status == 'Approved' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    <i class="fas fa-check-circle mr-1 text-green-600"></i>Approved
                                                </span>
                                            {% elif work.rm_status == 'Pending' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                    <i class="fas fa-clock mr-1 text-yellow-600"></i>Pending
                                                </span>
                                            {% elif work.rm_status == 'Rejected' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                    <i class="fas fa-times-circle mr-1 text-red-600"></i>Rejected
                                                </span>
                                            {% else %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                    <i class="fas fa-question-circle mr-1 text-gray-600"></i>{{ work.rm_status or 'Unknown' }}
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-16 bg-gray-50 rounded-xl">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-500 mb-2">No work history found</p>
                        <p class="text-gray-400">
                            {% if team_start or team_end or team_user or team_proj or team_desc or team_status %}
                                Try adjusting your filter criteria above.
                            {% else %}
                                Your team members' timesheet submissions will appear here.
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- Team Leave History -->
                <div x-show="teamTab === 'leave'" x-transition>
                    <!-- Filter Form for Team Leave History -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-filter mr-2"></i>Filter Team Leave History
                        </h4>
                        <form method="GET" action="{{ url_for('dashboard') }}" class="grid grid-cols-1 md:grid-cols-7 gap-3">
                            <input type="hidden" name="activeTab" value="team-history">
                            <input type="hidden" name="teamTab" value="leave">
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">From Date</label>
                                <input type="date" name="team_leave_start" value="{{ team_leaves_start }}"
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">To Date</label>
                                <input type="date" name="team_leave_end" value="{{ team_leaves_end }}"
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Team Member</label>
                                <select name="team_leave_emp" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Team Members</option>
                                    {% if employees %}
                                        {% for employee in employees %}
                                            <option value="{{ employee.username }}" 
                                                    {% if team_leaves_user == employee.username %}selected{% endif %}>
                                                {{ employee.name or employee.username }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Leave Type</label>
                                <select name="team_leave_type" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Types</option>
                                    <option value="Sick" {% if team_leaves_type == 'Sick' %}selected{% endif %}>Sick</option>
                                    <option value="Vacation" {% if team_leaves_type == 'Vacation' %}selected{% endif %}>Vacation</option>
                                    <option value="Personal" {% if team_leaves_type == 'Personal' %}selected{% endif %}>Personal</option>
                                    <option value="Casual" {% if team_leaves_type == 'Casual' %}selected{% endif %}>Casual</option>
                                    <option value="Other" {% if team_leaves_type == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
                                <input type="text" name="team_leave_desc" value="{{ team_leaves_desc }}" 
                                       placeholder="Search reason..."
                                       class="form-input w-full text-sm rounded border-gray-300">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                                <select name="team_leave_status" class="form-select w-full text-sm rounded border-gray-300">
                                    <option value="">All Status</option>
                                    <option value="Pending" {% if team_leaves_status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="Approved" {% if team_leaves_status == 'Approved' %}selected{% endif %}>Approved</option>
                                    <option value="Rejected" {% if team_leaves_status == 'Rejected' %}selected{% endif %}>Rejected</option>
                                </select>
                            </div>
                            
                            <div class="flex items-end space-x-2">
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center">
                                    <i class="fas fa-search mr-1"></i>Apply Filters
                                </button>
                                <a href="{{ url_for('dashboard', activeTab='team-history', teamTab='leave') }}" 
                                   class="bg-gray-500 hover:bg-gray-600 text-white text-sm px-4 py-2 rounded flex items-center">
                                    <i class="fas fa-redo mr-1"></i>Clear All
                                </a>
                            </div>
                        </form>
                        
                        <!-- Show active filters -->
                        {% if team_leaves_start or team_leaves_end or team_leaves_user or team_leaves_type or team_leaves_desc or team_leaves_status %}
                        <div class="mt-3 p-2 bg-blue-50 rounded">
                            <p class="text-xs text-blue-800 font-medium mb-1">Active Filters:</p>
                            <div class="flex flex-wrap gap-2">
                                {% if team_leaves_start %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    From: {{ team_leaves_start }}
                                </span>
                                {% endif %}
                                {% if team_leaves_end %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    To: {{ team_leaves_end }}
                                </span>
                                {% endif %}
                                {% if team_leaves_user %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Employee: {{ team_leaves_user }}
                                </span>
                                {% endif %}
                                {% if team_leaves_type %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Type: {{ team_leaves_type }}
                                </span>
                                {% endif %}
                                {% if team_leaves_desc %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Description: {{ team_leaves_desc }}
                                </span>
                                {% endif %}
                                {% if team_leaves_status %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                    Status: {{ team_leaves_status }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    {% if team_leaves %}
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-calendar-alt text-indigo-600 mr-2"></i>
                                Complete Team Leave History
                                <span class="ml-2 bg-indigo-100 text-indigo-800 text-sm font-medium px-2 py-1 rounded-full">
                                    {{ team_leaves|length }} records found
                                </span>
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">All leave requests from your team members</p>
                        </div>
                        <div class="overflow-x-auto" style="max-height: 28rem;">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Leave Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reason</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for leave in team_leaves %}
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">
                                            {{ leave.username }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                                {% if leave.leave_type == 'Sick' %}bg-red-100 text-red-800
                                                {% elif leave.leave_type in ['Vacation', 'Personal'] %}bg-blue-100 text-blue-800
                                                {% else %}bg-purple-100 text-purple-800{% endif %}">
                                                <i class="{% if leave.leave_type == 'Sick' %}fas fa-user-md
                                                   {% elif leave.leave_type in ['Vacation', 'Personal'] %}fas fa-plane
                                                   {% else %}fas fa-coffee{% endif %} mr-1"></i>
                                                {{ leave.leave_type }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ leave.start_date|dateformat }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ leave.end_date|dateformat }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {% if leave.duration_days %}
                                                <span class="font-medium">{{ leave.duration_days }} day(s)</span>
                                            {% else %}
                                                <span class="text-gray-500">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            <div class="max-w-xs truncate" title="{{ leave.description }}">
                                                {{ leave.description[:50] }}{% if leave.description|length > 50 %}...{% endif %}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            {% if leave.rm_status == 'Approved' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    <i class="fas fa-check-circle mr-1 text-green-600"></i>Approved
                                                </span>
                                            {% elif leave.rm_status == 'Pending' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                    <i class="fas fa-clock mr-1 text-yellow-600"></i>Pending
                                                </span>
                                            {% elif leave.rm_status == 'Rejected' %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                    <i class="fas fa-times-circle mr-1 text-red-600"></i>Rejected
                                                </span>
                                            {% else %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                    <i class="fas fa-question-circle mr-1 text-gray-600"></i>{{ leave.rm_status or 'Unknown' }}
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-16 bg-gray-50 rounded-xl">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-500 mb-2">No leave history found</p>
                        <p class="text-gray-400">
                            {% if team_leaves_start or team_leaves_end or team_leaves_user or team_leaves_type or team_leaves_desc or team_leaves_status %}
                                Try adjusting your filter criteria above.
                            {% else %}
                                Your team members' leave requests will appear here.
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Reject Modal -->
<div id="rejectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="flex-shrink-0">
                        <i class="fas fa-times-circle text-red-500 text-2xl"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-lg font-medium text-gray-900">Reject Request</h3>
                    </div>
                </div>
                <form id="rejectForm" method="post">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rejection Reason</label>
                        <textarea name="rejection_reason" rows="3" placeholder="Please provide a reason for rejection..." required
                                  class="form-textarea w-full rounded-lg border-gray-300"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeRejectModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">
                            <i class="fas fa-times mr-1"></i>Reject
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
function showRejectModal(type, id) {
    const form = document.getElementById('rejectForm');
    if (type === 'timesheet') {
        form.action = '{{ url_for("reject_timesheet_action") }}';
    } else if (type === 'leave') {
        form.action = '{{ url_for("reject_leave_action") }}';
    }
    
    const existingInput = form.querySelector('input[name="id"]');
    if (existingInput) {
        existingInput.remove();
    }
    
    const hiddenInput = document.createElement('input');
    hiddenInput.type = 'hidden';
    hiddenInput.name = 'id';
    hiddenInput.value = id;
    form.appendChild(hiddenInput);
    
    document.getElementById('rejectModal').classList.remove('hidden');
}

function closeRejectModal() {
    document.getElementById('rejectModal').classList.add('hidden');
    document.getElementById('rejectForm').reset();
}

function downloadReport() {
    window.location.href = '/download-timesheet-report';
}

function changePassword() {
    window.location.href = '/change-password';
}

function viewProfile() {
    window.location.href = '/profile';
}

// Close modals when clicking outside
document.getElementById('rejectModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRejectModal();
    }
});

// Enhanced tab state management
document.addEventListener('DOMContentLoaded', function() {
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('activeTab') || 'timesheet';
    const teamTab = urlParams.get('teamTab') || 'work';
    
    // Set initial tab states
    setTimeout(() => {
        if (window.Alpine) {
            const element = document.querySelector('[x-data]');
            if (element && element._x_dataStack && element._x_dataStack[0]) {
                element._x_dataStack[0].activeTab = activeTab;
                element._x_dataStack[0].teamTab = teamTab;
            }
        }
    }, 100);
    
    // Debug: Log filter form submissions
    const forms = document.querySelectorAll('form[method="GET"]');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const formData = new FormData(form);
            const params = new URLSearchParams(formData);
            console.log('ðŸ” Form submitted with params:', Object.fromEntries(params));
        });
    });
});
</script>

<style>
.form-input, .form-select, .form-textarea {
    display: block;
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    line-height: 1.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.transition-colors {
    transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, color 0.15s ease-in-out;
}

.overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
}

.overflow-x-auto::-webkit-scrollbar { height: 6px; }
.overflow-x-auto::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
.overflow-x-auto::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
.overflow-x-auto::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

tbody tr:hover {
    background-color: #f9fafb;
}

.inline-flex {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

button:hover {
    transform: translateY(-1px);
    transition: all 0.2s ease-in-out;
}

.bg-white:hover {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease-in-out;
}

[x-cloak] { display: none !important; }

/* Multi-select styling */
select[multiple] {
    height: auto !important;
    min-height: 8rem;
}

select[multiple] option {
    padding: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
}

select[multiple] option:checked {
    background-color: #3b82f6;
    color: white;
}
</style>
{% endblock %}
